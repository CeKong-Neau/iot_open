/* Stellar.js v0.6.2 | Copyright 2014, Mark Dalgleish | http://markdalgleish.com/projects/stellar.js | http://markdalgleish.mit-license.org */
!function(L,J,K,O){function A(P,Q){this.element=P,this.options=L.extend({},N,Q),this._defaults=N,this._name=M,this.init()}var M="stellar",N={scrollProperty:"scroll",positionProperty:"position",horizontalScrolling:!0,verticalScrolling:!0,horizontalOffset:0,verticalOffset:0,responsive:!1,parallaxBackgrounds:!0,parallaxElements:!0,hideDistantElements:!0,hideElement:function(P){P.hide()},showElement:function(P){P.show()}},D={scroll:{getLeft:function(P){return P.scrollLeft()},setLeft:function(Q,P){Q.scrollLeft(P)},getTop:function(P){return P.scrollTop()},setTop:function(Q,P){Q.scrollTop(P)}},position:{getLeft:function(P){return -1*parseInt(P.css("left"),10)},getTop:function(P){return -1*parseInt(P.css("top"),10)}},margin:{getLeft:function(P){return -1*parseInt(P.css("margin-left"),10)},getTop:function(P){return -1*parseInt(P.css("margin-top"),10)}},transform:{getLeft:function(Q){var P=getComputedStyle(Q[0])[C];return"none"!==P?-1*parseInt(P.match(/(-?[0-9]+)/g)[4],10):0},getTop:function(Q){var P=getComputedStyle(Q[0])[C];return"none"!==P?-1*parseInt(P.match(/(-?[0-9]+)/g)[5],10):0}}},E={position:{setLeft:function(Q,P){Q.css("left",P)},setTop:function(Q,P){Q.css("top",P)}},transform:{setPosition:function(T,R,S,P,Q){T[0].style[C]="translate3d("+(R-S)+"px, "+(P-Q)+"px, 0)"}}},B=function(){var R,S=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,P=L("script")[0].style,Q="";for(R in P){if(S.test(R)){Q=R.match(S)[0];break}}return"WebkitOpacity" in P&&(Q="Webkit"),"KhtmlOpacity" in P&&(Q="Khtml"),function(T){return Q+(Q.length>0?T.charAt(0).toUpperCase()+T.slice(1):T)}}(),C=B("transform"),H=L("<div />",{style:"background:#fff"}).css("background-position-x")!==O,I=H?function(R,P,Q){R.css({"background-position-x":P,"background-position-y":Q})}:function(R,P,Q){R.css("background-position",P+" "+Q)},F=H?function(P){return[P.css("background-position-x"),P.css("background-position-y")]}:function(P){return P.css("background-position").split(" ")},G=J.requestAnimationFrame||J.webkitRequestAnimationFrame||J.mozRequestAnimationFrame||J.oRequestAnimationFrame||J.msRequestAnimationFrame||function(P){setTimeout(P,1000/60)};A.prototype={init:function(){this.options.name=M+"_"+Math.floor(1000000000*Math.random()),this._defineElements(),this._defineGetters(),this._defineSetters(),this._handleWindowLoadAndResize(),this._detectViewport(),this.refresh({firstLoad:!0}),"scroll"===this.options.scrollProperty?this._handleScrollEvent():this._startAnimationLoop()},_defineElements:function(){this.element===K.body&&(this.element=J),this.$scrollElement=L(this.element),this.$element=this.element===J?L("body"):this.$scrollElement,this.$viewportElement=this.options.viewportElement!==O?L(this.options.viewportElement):this.$scrollElement[0]===J||"scroll"===this.options.scrollProperty?this.$scrollElement:this.$scrollElement.parent()},_defineGetters:function(){var Q=this,P=D[Q.options.scrollProperty];this._getScrollLeft=function(){return P.getLeft(Q.$scrollElement)},this._getScrollTop=function(){return P.getTop(Q.$scrollElement)}},_defineSetters:function(){var R=this,S=D[R.options.scrollProperty],P=E[R.options.positionProperty],Q=S.setLeft,T=S.setTop;this._setScrollLeft="function"==typeof Q?function(U){Q(R.$scrollElement,U)}:L.noop,this._setScrollTop="function"==typeof T?function(U){T(R.$scrollElement,U)}:L.noop,this._setPosition=P.setPosition||function(X,W,V,Y,U){R.options.horizontalScrolling&&P.setLeft(X,W,V),R.options.verticalScrolling&&P.setTop(X,Y,U)}},_handleWindowLoadAndResize:function(){var Q=this,P=L(J);Q.options.responsive&&P.bind("load."+this.name,function(){Q.refresh()}),P.bind("resize."+this.name,function(){Q._detectViewport(),Q.options.responsive&&Q.refresh()})},refresh:function(R){var P=this,Q=P._getScrollLeft(),S=P._getScrollTop();R&&R.firstLoad||this._reset(),this._setScrollLeft(0),this._setScrollTop(0),this._setOffsets(),this._findParticles(),this._findBackgrounds(),R&&R.firstLoad&&/WebKit/.test(navigator.userAgent)&&L(J).load(function(){var U=P._getScrollLeft(),T=P._getScrollTop();P._setScrollLeft(U+1),P._setScrollTop(T+1),P._setScrollLeft(U),P._setScrollTop(T)}),this._setScrollLeft(Q),this._setScrollTop(S)},_detectViewport:function(){var Q=this.$viewportElement.offset(),P=null!==Q&&Q!==O;this.viewportWidth=this.$viewportElement.width(),this.viewportHeight=this.$viewportElement.height(),this.viewportOffsetTop=P?Q.top:0,this.viewportOffsetLeft=P?Q.left:0},_findParticles:function(){var P=this;this._getScrollLeft(),this._getScrollTop();if(this.particles!==O){for(var Q=this.particles.length-1;Q>=0;Q--){this.particles[Q].$element.data("stellar-elementIsActive",O)}}this.particles=[],this.options.parallaxElements&&this.$element.find("[data-stellar-ratio]").each(function(){var d,R,r,s,W,X,U,V,a,b=L(this),Y=0,Z=0,S=0,T=0;if(b.data("stellar-elementIsActive")){if(b.data("stellar-elementIsActive")!==this){return}}else{b.data("stellar-elementIsActive",this)}P.options.showElement(b),b.data("stellar-startingLeft")?(b.css("left",b.data("stellar-startingLeft")),b.css("top",b.data("stellar-startingTop"))):(b.data("stellar-startingLeft",b.css("left")),b.data("stellar-startingTop",b.css("top"))),r=b.position().left,s=b.position().top,W="auto"===b.css("margin-left")?0:parseInt(b.css("margin-left"),10),X="auto"===b.css("margin-top")?0:parseInt(b.css("margin-top"),10),V=b.offset().left-W,a=b.offset().top-X,b.parents().each(function(){var c=L(this);return c.data("stellar-offset-parent")===!0?(Y=S,Z=T,U=c,!1):(S+=c.position().left,void (T+=c.position().top))}),d=b.data("stellar-horizontal-offset")!==O?b.data("stellar-horizontal-offset"):U!==O&&U.data("stellar-horizontal-offset")!==O?U.data("stellar-horizontal-offset"):P.horizontalOffset,R=b.data("stellar-vertical-offset")!==O?b.data("stellar-vertical-offset"):U!==O&&U.data("stellar-vertical-offset")!==O?U.data("stellar-vertical-offset"):P.verticalOffset,P.particles.push({$element:b,$offsetParent:U,isFixed:"fixed"===b.css("position"),horizontalOffset:d,verticalOffset:R,startingPositionLeft:r,startingPositionTop:s,startingOffsetLeft:V,startingOffsetTop:a,parentOffsetLeft:Y,parentOffsetTop:Z,stellarRatio:b.data("stellar-ratio")!==O?b.data("stellar-ratio"):1,width:b.outerWidth(!0),height:b.outerHeight(!0),isHidden:!1})})},_findBackgrounds:function(){var Q,R=this,P=this._getScrollLeft(),S=this._getScrollTop();this.backgrounds=[],this.options.parallaxBackgrounds&&(Q=this.$element.find("[data-stellar-background-ratio]"),this.$element.data("stellar-background-ratio")&&(Q=Q.add(this.$element)),Q.each(function(){var f,m,a,c,Y,Z,e,d=L(this),V=F(d),W=0,T=0,U=0,X=0;if(d.data("stellar-backgroundIsActive")){if(d.data("stellar-backgroundIsActive")!==this){return}}else{d.data("stellar-backgroundIsActive",this)}d.data("stellar-backgroundStartingLeft")?I(d,d.data("stellar-backgroundStartingLeft"),d.data("stellar-backgroundStartingTop")):(d.data("stellar-backgroundStartingLeft",V[0]),d.data("stellar-backgroundStartingTop",V[1])),a="auto"===d.css("margin-left")?0:parseInt(d.css("margin-left"),10),c="auto"===d.css("margin-top")?0:parseInt(d.css("margin-top"),10),Y=d.offset().left-a-P,Z=d.offset().top-c-S,d.parents().each(function(){var g=L(this);return g.data("stellar-offset-parent")===!0?(W=U,T=X,e=g,!1):(U+=g.position().left,void (X+=g.position().top))}),f=d.data("stellar-horizontal-offset")!==O?d.data("stellar-horizontal-offset"):e!==O&&e.data("stellar-horizontal-offset")!==O?e.data("stellar-horizontal-offset"):R.horizontalOffset,m=d.data("stellar-vertical-offset")!==O?d.data("stellar-vertical-offset"):e!==O&&e.data("stellar-vertical-offset")!==O?e.data("stellar-vertical-offset"):R.verticalOffset,R.backgrounds.push({$element:d,$offsetParent:e,isFixed:"fixed"===d.css("background-attachment"),horizontalOffset:f,verticalOffset:m,startingValueLeft:V[0],startingValueTop:V[1],startingBackgroundPositionLeft:isNaN(parseInt(V[0],10))?0:parseInt(V[0],10),startingBackgroundPositionTop:isNaN(parseInt(V[1],10))?0:parseInt(V[1],10),startingPositionLeft:d.position().left,startingPositionTop:d.position().top,startingOffsetLeft:Y,startingOffsetTop:Z,parentOffsetLeft:W,parentOffsetTop:T,stellarRatio:d.data("stellar-background-ratio")===O?1:d.data("stellar-background-ratio")})}))},_reset:function(){var T,R,S,P,Q;for(Q=this.particles.length-1;Q>=0;Q--){T=this.particles[Q],R=T.$element.data("stellar-startingLeft"),S=T.$element.data("stellar-startingTop"),this._setPosition(T.$element,R,R,S,S),this.options.showElement(T.$element),T.$element.data("stellar-startingLeft",null).data("stellar-elementIsActive",null).data("stellar-backgroundIsActive",null)}for(Q=this.backgrounds.length-1;Q>=0;Q--){P=this.backgrounds[Q],P.$element.data("stellar-backgroundStartingLeft",null).data("stellar-backgroundStartingTop",null),I(P.$element,P.startingValueLeft,P.startingValueTop)}},destroy:function(){this._reset(),this.$scrollElement.unbind("resize."+this.name).unbind("scroll."+this.name),this._animationLoop=L.noop,L(J).unbind("load."+this.name).unbind("resize."+this.name)},_setOffsets:function(){var Q=this,P=L(J);P.unbind("resize.horizontal-"+this.name).unbind("resize.vertical-"+this.name),"function"==typeof this.options.horizontalOffset?(this.horizontalOffset=this.options.horizontalOffset(),P.bind("resize.horizontal-"+this.name,function(){Q.horizontalOffset=Q.options.horizontalOffset()})):this.horizontalOffset=this.options.horizontalOffset,"function"==typeof this.options.verticalOffset?(this.verticalOffset=this.options.verticalOffset(),P.bind("resize.vertical-"+this.name,function(){Q.verticalOffset=Q.options.verticalOffset()})):this.verticalOffset=this.options.verticalOffset},_repositionElements:function(){var Z,X,Y,q,P,m,p,S,T,Q,R=this._getScrollLeft(),W=this._getScrollTop(),U=!0,V=!0;if(this.currentScrollLeft!==R||this.currentScrollTop!==W||this.currentWidth!==this.viewportWidth||this.currentHeight!==this.viewportHeight){for(this.currentScrollLeft=R,this.currentScrollTop=W,this.currentWidth=this.viewportWidth,this.currentHeight=this.viewportHeight,Q=this.particles.length-1;Q>=0;Q--){Z=this.particles[Q],X=Z.isFixed?1:0,this.options.horizontalScrolling?(m=(R+Z.horizontalOffset+this.viewportOffsetLeft+Z.startingPositionLeft-Z.startingOffsetLeft+Z.parentOffsetLeft)*-(Z.stellarRatio+X-1)+Z.startingPositionLeft,S=m-Z.startingPositionLeft+Z.startingOffsetLeft):(m=Z.startingPositionLeft,S=Z.startingOffsetLeft),this.options.verticalScrolling?(p=(W+Z.verticalOffset+this.viewportOffsetTop+Z.startingPositionTop-Z.startingOffsetTop+Z.parentOffsetTop)*-(Z.stellarRatio+X-1)+Z.startingPositionTop,T=p-Z.startingPositionTop+Z.startingOffsetTop):(p=Z.startingPositionTop,T=Z.startingOffsetTop),this.options.hideDistantElements&&(V=!this.options.horizontalScrolling||S+Z.width>(Z.isFixed?0:R)&&S<(Z.isFixed?0:R)+this.viewportWidth+this.viewportOffsetLeft,U=!this.options.verticalScrolling||T+Z.height>(Z.isFixed?0:W)&&T<(Z.isFixed?0:W)+this.viewportHeight+this.viewportOffsetTop),V&&U?(Z.isHidden&&(this.options.showElement(Z.$element),Z.isHidden=!1),this._setPosition(Z.$element,m,Z.startingPositionLeft,p,Z.startingPositionTop)):Z.isHidden||(this.options.hideElement(Z.$element),Z.isHidden=!0)}for(Q=this.backgrounds.length-1;Q>=0;Q--){Y=this.backgrounds[Q],X=Y.isFixed?0:1,q=this.options.horizontalScrolling?(R+Y.horizontalOffset-this.viewportOffsetLeft-Y.startingOffsetLeft+Y.parentOffsetLeft-Y.startingBackgroundPositionLeft)*(X-Y.stellarRatio)+"px":Y.startingValueLeft,P=this.options.verticalScrolling?(W+Y.verticalOffset-this.viewportOffsetTop-Y.startingOffsetTop+Y.parentOffsetTop-Y.startingBackgroundPositionTop)*(X-Y.stellarRatio)+"px":Y.startingValueTop,I(Y.$element,q,P)}}},_handleScrollEvent:function(){var S=this,Q=!1,R=function(){S._repositionElements(),Q=!1},P=function(){Q||(G(R),Q=!0)};this.$scrollElement.bind("scroll."+this.name,P),P()},_startAnimationLoop:function(){var P=this;this._animationLoop=function(){G(P._animationLoop),P._repositionElements()},this._animationLoop()}},L.fn[M]=function(P){var Q=arguments;return P===O||"object"==typeof P?this.each(function(){L.data(this,"plugin_"+M)||L.data(this,"plugin_"+M,new A(this,P))}):"string"==typeof P&&"_"!==P[0]&&"init"!==P?this.each(function(){var R=L.data(this,"plugin_"+M);R instanceof A&&"function"==typeof R[P]&&R[P].apply(R,Array.prototype.slice.call(Q,1)),"destroy"===P&&L.data(this,"plugin_"+M,null)}):void 0},L[M]=function(){var P=L(J);return P.stellar.apply(P,Array.prototype.slice.call(arguments,0))},L[M].scrollProperty=D,L[M].positionProperty=E,J.Stellar=A}(jQuery,this,document);