(function(A,C,G){var H=function(L,J){var K=C.createElementNS("http://www.w3.org/2000/svg",L);A.each(J,function(N,M){K.setAttribute(N,M)});return K},D="createElementNS" in C&&H("svg",{}).createSVGRect,F=1/(window.devicePixelRatio||1),E=A.fn.peity=function(K,J){D&&this.each(function(){var O=A(this),M=O.data("peity");if(M){K&&(M.type=K),A.extend(M.opts,J)}else{var P=E.defaults[K],L={};A.each(O.data(),function(R,Q){R in P&&(L[R]=Q)});var N=A.extend({},P,L,J),M=new B(O,K,N);O.change(function(){M.draw()}).data("peity",M)}M.draw()});return this},B=function(L,J,K){this.$el=L;this.type=J;this.opts=K},I=B.prototype;I.draw=function(){E.graphers[this.type].call(this,this.opts)};I.fill=function(){var K=this.opts.fill,J=K;A.isFunction(J)||(J=function(M,L){return K[L%K.length]});return J};I.prepare=function(L,J){var K;this.svg?K=A(this.svg).empty():(this.svg=H("svg",{"class":"peity"}),this.$el.hide().after(this.svg),K=A(this.svg).data("peity",this));this.svg.setAttribute("height",J);this.svg.setAttribute("width",L);return K};I.values=function(){return A.map(this.$el.text().split(this.opts.delimiter),function(J){return parseFloat(J)})};E.defaults={};E.graphers={};E.register=function(L,J,K){this.defaults[L]=J;this.graphers[L]=K};E.register("pie",{delimiter:null,diameter:16,fill:["#ff9900","#fff4dd","#ffc66e"]},function(V){if(!V.delimiter){var T=this.$el.text().match(/[^0-9\.]/);V.delimiter=T?T[0]:","}T=this.values();if("/"==V.delimiter){var U=T[0],T=[U,G.max(0,T[1]-U)]}for(var Y=0,U=T.length,W=0;Y<U;Y++){W+=T[Y]}for(var V=this.prepare(V.width||V.diameter,V.height||V.diameter),Y=V.width(),X=V.height(),V=Y/2,X=X/2,K=G.min(V,X),J=G.PI,N=this.fill(),P=-J/2,Y=0;Y<U;Y++){var Q=T[Y],R=Q/W,O;if(0!=R){if(1==R){O=H("circle",{cx:V,cy:X,r:K})}else{O=2*R*J;var R=P+O,S=K*G.cos(P)+V,P=K*G.sin(P)+X,L=K*G.cos(R)+V,M=K*G.sin(R)+X;O=H("path",{d:["M",V,X,"L",S,P,"A",K,K,0,O>J?1:0,1,L,M,"Z"].join(" ")});P=R}O.setAttribute("fill",N.call(this,Q,Y,T));this.svg.appendChild(O)}}});E.register("line",{delimiter:",",fill:"#c6d9fd",height:16,max:null,min:0,stroke:"#4d89f9",strokeWidth:1,width:32},function(P){var N=this.values();1==N.length&&N.push(N[0]);for(var O=G.max.apply(G,N.concat([P.max])),S=G.min.apply(G,N.concat([P.min])),Q=this.prepare(P.width,P.height),R=Q.width(),Q=Q.height()-P.strokeWidth,J=R/(N.length-1),O=O-S,K=0==O?Q:Q/O,M=Q+S*K,O=[0,M],L=0;L<N.length;L++){O.push(L*J,Q-K*(N[L]-S)+P.strokeWidth/2)}O.push(R,M);N=H("polygon",{fill:P.fill,points:O.join(" ")});this.svg.appendChild(N);P.strokeWidth&&(P=H("polyline",{fill:"transparent",points:O.slice(2,O.length-2).join(" "),stroke:P.stroke,"stroke-width":P.strokeWidth,"stroke-linecap":"square"}),this.svg.appendChild(P))});E.register("bar",{delimiter:",",fill:["#4D89F9"],gap:1,height:16,max:null,min:0,width:32},function(S){for(var Q=this.values(),R=G.max.apply(G,Q.concat([S.max])),V=G.min.apply(G,Q.concat([S.min])),T=this.prepare(S.width,S.height),U=T.width(),T=T.height(),J=R-V,K=0==J?0:T/J,S=S.gap,U=(U+S)/Q.length,P=this.fill(),M=0;M<Q.length;M++){var N=Q[M],O=T-K*(N-V),L=K*N;if(0==L){if(L=F,0>=V&&0<R||0==J){O-=F}}else{0>L&&(O+=L,L=-L)}N=H("rect",{fill:P.call(this,N,M,Q),x:M*U,y:O,width:U-S,height:L});this.svg.appendChild(N)}})})(jQuery,document,Math);