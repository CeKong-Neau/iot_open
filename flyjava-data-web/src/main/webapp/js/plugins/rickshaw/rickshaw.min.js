(function(A,B){if(typeof define==="function"&&define.amd){define(["d3"],function(C){return A.Rickshaw=B(C)})}else{if(typeof exports==="object"){module.exports=B(require("d3"))}else{A.Rickshaw=B(d3)}}})(this,function(B){var A={namespace:function(C,E){var D=C.split(".");var I=A;for(var F=1,G=D.length;F<G;F++){var H=D[F];I[H]=I[H]||{};I=I[H]}return I},keys:function(D){var E=[];for(var C in D){E.push(C)}return E},extend:function(C,D){for(var E in D){C[E]=D[E]}return C},clone:function(C){return JSON.parse(JSON.stringify(C))}};(function(F){var H=Object.prototype.toString,V="Null",U="Undefined",D="Boolean",Q="Number",C="String",E="Object",T="[object Function]";function S(Y){return H.call(Y)===T}function M(Y,Z){for(var a in Z){if(Z.hasOwnProperty(a)){Y[a]=Z[a]}}return Y}function P(Y){if(K(Y)!==E){throw new TypeError}var a=[];for(var Z in Y){if(Y.hasOwnProperty(Z)){a.push(Z)}}return a}function K(Z){switch(Z){case null:return V;case void 0:return U}var Y=typeof Z;switch(Y){case"boolean":return D;case"number":return Q;case"string":return C}return E}function G(Y){return typeof Y==="undefined"}var N=Array.prototype.slice;function L(Y){var Z=Y.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return Z.length==1&&!Z[0]?[]:Z}function W(Z,Y){var a=Z;return function(){var b=R([J(a,this)],arguments);return Y.apply(this,b)}}function R(Z,b){var Y=Z.length,a=b.length;while(a--){Z[Y+a]=b[a]}return Z}function O(Y,Z){Y=N.call(Y,0);return R(Y,Z)}function J(Z,Y){if(arguments.length<2&&G(arguments[0])){return this}var a=Z,b=N.call(arguments,2);return function(){var c=O(b,arguments);return a.apply(Y,c)}}var X=function(){};var I=function(){var Y=function(){for(var c in {toString:1}){if(c==="toString"){return false}}return true}();function b(){}function Z(){var j=null,g=[].slice.apply(arguments);if(S(g[0])){j=g.shift()}function h(){this.initialize.apply(this,arguments)}M(h,I.Methods);h.superclass=j;h.subclasses=[];if(j){b.prototype=j.prototype;h.prototype=new b;try{j.subclasses.push(h)}catch(d){}}for(var c=0,f=g.length;c<f;c++){h.addMethods(g[c])}if(!h.prototype.initialize){h.prototype.initialize=X}h.prototype.constructor=h;return h}function a(g){var k=this.superclass&&this.superclass.prototype,h=P(g);if(Y){if(g.toString!=Object.prototype.toString){h.push("toString")}if(g.valueOf!=Object.prototype.valueOf){h.push("valueOf")}}for(var f=0,d=h.length;f<d;f++){var c=h[f],e=g[c];if(k&&S(e)&&L(e)[0]=="$super"){var j=e;e=W(function(i){return function(){return k[i].apply(this,arguments)}}(c),j);e.valueOf=J(j.valueOf,j);e.toString=J(j.toString,j)}this.prototype[c]=e}return this}return{create:Z,Methods:{addMethods:a}}}();if(F.exports){F.exports.Class=I}else{F.Class=I}})(A);A.namespace("Rickshaw.Compat.ClassList");A.Compat.ClassList=function(){if(typeof document!=="undefined"&&!("classList" in document.createElement("a"))){(function(O){var N="classList",G="prototype",P=(O.HTMLElement||O.Element)[G],C=Object,H=String[G].trim||function(){return this.replace(/^\s+|\s+$/g,"")},E=Array[G].indexOf||function(R){var Q=0,S=this.length;for(;Q<S;Q++){if(Q in this&&this[Q]===R){return Q}}return -1},K=function(Q,R){this.name=Q;this.code=DOMException[Q];this.message=R},I=function(R,Q){if(Q===""){throw new K("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(Q)){throw new K("INVALID_CHARACTER_ERR","String contains an invalid character")}return E.call(R,Q)},F=function(S){var R=H.call(S.className),U=R?R.split(/\s+/):[],Q=0,T=U.length;for(;Q<T;Q++){this.push(U[Q])}this._updateClassName=function(){S.className=this.toString()}},M=F[G]=[],L=function(){return new F(this)};K[G]=Error[G];M.item=function(Q){return this[Q]||null};M.contains=function(Q){Q+="";return I(this,Q)!==-1};M.add=function(Q){Q+="";if(I(this,Q)===-1){this.push(Q);this._updateClassName()}};M.remove=function(Q){Q+="";var R=I(this,Q);if(R!==-1){this.splice(R,1);this._updateClassName()}};M.toggle=function(Q){Q+="";if(I(this,Q)===-1){this.add(Q)}else{this.remove(Q)}};M.toString=function(){return this.join(" ")};if(C.defineProperty){var D={get:L,enumerable:true,configurable:true};try{C.defineProperty(P,N,D)}catch(J){if(J.number===-2146823252){D.enumerable=false;C.defineProperty(P,N,D)}}}else{if(C[G].__defineGetter__){P.__defineGetter__(N,L)}}})(window)}};if(typeof RICKSHAW_NO_COMPAT!=="undefined"&&!RICKSHAW_NO_COMPAT||typeof RICKSHAW_NO_COMPAT==="undefined"){new A.Compat.ClassList}A.namespace("Rickshaw.Graph");A.Graph=function(D){var C=this;this.initialize=function(E){if(!E.element){throw"Rickshaw.Graph needs a reference to an element"}if(E.element.nodeType!==1){throw"Rickshaw.Graph element was defined but not an HTML element"}this.element=E.element;this.series=E.series;this.window={};this.updateCallbacks=[];this.configureCallbacks=[];this.defaults={interpolation:"cardinal",offset:"zero",min:undefined,max:undefined,preserve:false,xScale:undefined,yScale:undefined,stack:true};this._loadRenderers();this.configure(E);this.validateSeries(E.series);this.series.active=function(){return C.series.filter(function(F){return !F.disabled})};this.setSize({width:E.width,height:E.height});this.element.classList.add("rickshaw_graph");this.vis=B.select(this.element).append("svg:svg").attr("width",this.width).attr("height",this.height);this.discoverRange()};this._loadRenderers=function(){for(var F in A.Graph.Renderer){if(!F||!A.Graph.Renderer.hasOwnProperty(F)){continue}var E=A.Graph.Renderer[F];if(!E||!E.prototype||!E.prototype.render){continue}C.registerRenderer(new E({graph:C}))}};this.validateSeries=function(G){if(!Array.isArray(G)&&!(G instanceof A.Series)){var E=Object.prototype.toString.apply(G);throw"series is not an array: "+E}var F;G.forEach(function(H){if(!(H instanceof Object)){throw"series element is not an object: "+H}if(!H.data){throw"series has no data: "+JSON.stringify(H)}if(!Array.isArray(H.data)){throw"series data is not an array: "+JSON.stringify(H.data)}if(H.data.length>0){var I=H.data[0].x;var J=H.data[0].y;if(typeof I!="number"||typeof J!="number"&&J!==null){throw"x and y properties of points should be numbers instead of "+typeof I+" and "+typeof J}}if(H.data.length>=3){if(H.data[2].x<H.data[1].x||H.data[1].x<H.data[0].x||H.data[H.data.length-1].x<H.data[0].x){throw"series data needs to be sorted on x values for series name: "+H.name}}},this)};this.dataDomain=function(){var G=this.series.map(function(H){return H.data});var E=B.min(G.map(function(H){return H[0].x}));var F=B.max(G.map(function(H){return H[H.length-1].x}));return[E,F]};this.discoverRange=function(){var E=this.renderer.domain();this.x=(this.xScale||B.scale.linear()).copy().domain(E.x).range([0,this.width]);this.y=(this.yScale||B.scale.linear()).copy().domain(E.y).range([this.height,0]);this.x.magnitude=B.scale.linear().domain([E.x[0]-E.x[0],E.x[1]-E.x[0]]).range([0,this.width]);this.y.magnitude=B.scale.linear().domain([E.y[0]-E.y[0],E.y[1]-E.y[0]]).range([0,this.height])};this.render=function(){var E=this.stackData();this.discoverRange();this.renderer.render();this.updateCallbacks.forEach(function(F){F()})};this.update=this.render;this.stackData=function(){var I=this.series.active().map(function(J){return J.data}).map(function(J){return J.filter(function(K){return this._slice(K)},this)},this);var F=this.preserve;if(!F){this.series.forEach(function(J){if(J.scale){F=true}})}I=F?A.clone(I):I;this.series.active().forEach(function(K,J){if(K.scale){var L=I[J];if(L){L.forEach(function(M){M.y=K.scale(M.y)})}}});this.stackData.hooks.data.forEach(function(J){I=J.f.apply(C,[I])});var G;if(!this.renderer.unstack){this._validateStackable();var H=B.layout.stack();H.offset(C.offset);G=H(I)}G=G||I;if(this.renderer.unstack){G.forEach(function(J){J.forEach(function(K){K.y0=K.y0===undefined?0:K.y0})})}this.stackData.hooks.after.forEach(function(J){G=J.f.apply(C,[I])});var E=0;this.series.forEach(function(J){if(J.disabled){return}J.stack=G[E++]});this.stackedData=G;return G};this._validateStackable=function(){var F=this.series;var E;F.forEach(function(G){E=E||G.data.length;if(E&&G.data.length!=E){throw"stacked series cannot have differing numbers of points: "+E+" vs "+G.data.length+"; see Rickshaw.Series.fill()"}},this)};this.stackData.hooks={data:[],after:[]};this._slice=function(E){if(this.window.xMin||this.window.xMax){var F=true;if(this.window.xMin&&E.x<this.window.xMin){F=false}if(this.window.xMax&&E.x>this.window.xMax){F=false}return F}return true};this.onUpdate=function(E){this.updateCallbacks.push(E)};this.onConfigure=function(E){this.configureCallbacks.push(E)};this.registerRenderer=function(E){this._renderers=this._renderers||{};this._renderers[E.name]=E};this.configure=function(F){this.config=this.config||{};if(F.width||F.height){this.setSize(F)}A.keys(this.defaults).forEach(function(G){this.config[G]=G in F?F[G]:G in this?this[G]:this.defaults[G]},this);A.keys(this.config).forEach(function(G){this[G]=this.config[G]},this);if("stack" in F){F.unstack=!F.stack}var E=F.renderer||this.renderer&&this.renderer.name||"stack";this.setRenderer(E,F);this.configureCallbacks.forEach(function(G){G(F)})};this.setRenderer=function(E,F){if(typeof E=="function"){this.renderer=new E({graph:C});this.registerRenderer(this.renderer)}else{if(!this._renderers[E]){throw"couldn't find renderer "+E}this.renderer=this._renderers[E]}if(typeof F=="object"){this.renderer.configure(F)}};this.setSize=function(H){H=H||{};if(typeof window!==undefined){var F=window.getComputedStyle(this.element,null);var E=parseInt(F.getPropertyValue("width"),10);var G=parseInt(F.getPropertyValue("height"),10)}this.width=H.width||E||400;this.height=H.height||G||250;this.vis&&this.vis.attr("width",this.width).attr("height",this.height)};this.initialize(D)};A.namespace("Rickshaw.Fixtures.Color");A.Fixtures.Color=function(){this.schemes={};this.schemes.spectrum14=["#ecb796","#dc8f70","#b2a470","#92875a","#716c49","#d2ed82","#bbe468","#a1d05d","#e7cbe6","#d8aad6","#a888c2","#9dc2d3","#649eb9","#387aa3"].reverse();this.schemes.spectrum2000=["#57306f","#514c76","#646583","#738394","#6b9c7d","#84b665","#a7ca50","#bfe746","#e2f528","#fff726","#ecdd00","#d4b11d","#de8800","#de4800","#c91515","#9a0000","#7b0429","#580839","#31082b"];this.schemes.spectrum2001=["#2f243f","#3c2c55","#4a3768","#565270","#6b6b7c","#72957f","#86ad6e","#a1bc5e","#b8d954","#d3e04e","#ccad2a","#cc8412","#c1521d","#ad3821","#8a1010","#681717","#531e1e","#3d1818","#320a1b"];this.schemes.classic9=["#423d4f","#4a6860","#848f39","#a2b73c","#ddcb53","#c5a32f","#7d5836","#963b20","#7c2626","#491d37","#2f254a"].reverse();this.schemes.httpStatus={503:"#ea5029",502:"#d23f14",500:"#bf3613",410:"#efacea",409:"#e291dc",403:"#f457e8",408:"#e121d2",401:"#b92dae",405:"#f47ceb",404:"#a82a9f",400:"#b263c6",301:"#6fa024",302:"#87c32b",307:"#a0d84c",304:"#28b55c",200:"#1a4f74",206:"#27839f",201:"#52adc9",202:"#7c979f",203:"#a5b8bd",204:"#c1cdd1"};this.schemes.colorwheel=["#b5b6a9","#858772","#785f43","#96557e","#4682b4","#65b9ac","#73c03a","#cb513a"].reverse();this.schemes.cool=["#5e9d2f","#73c03a","#4682b4","#7bc3b8","#a9884e","#c1b266","#a47493","#c09fb5"];this.schemes.munin=["#00cc00","#0066b3","#ff8000","#ffcc00","#330099","#990099","#ccff00","#ff0000","#808080","#008f00","#00487d","#b35a00","#b38f00","#6b006b","#8fb300","#b30000","#bebebe","#80ff80","#80c9ff","#ffc080","#ffe680","#aa80ff","#ee00cc","#ff8080","#666600","#ffbfff","#00ffcc","#cc6699","#999900"]};A.namespace("Rickshaw.Fixtures.RandomData");A.Fixtures.RandomData=function(C){var E;C=C||1;var F=200;var D=Math.floor((new Date).getTime()/1000);this.addData=function(J){var H=Math.random()*100+15+F;var I=J[0].length;var G=1;J.forEach(function(M){var K=Math.random()*20;var L=H/25+G+++(Math.cos(I*G*11/960)+2)*15+(Math.cos(I/7)+2)*7+(Math.cos(I/17)+2)*1;M.push({x:I*C+D,y:L+K})});F=H*0.85};this.removeData=function(G){G.forEach(function(H){H.shift()});D+=C}};A.namespace("Rickshaw.Fixtures.Time");A.Fixtures.Time=function(){var C=this;this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];this.units=[{name:"decade",seconds:86400*365.25*10,formatter:function(D){return parseInt(D.getUTCFullYear()/10,10)*10}},{name:"year",seconds:86400*365.25,formatter:function(D){return D.getUTCFullYear()}},{name:"month",seconds:86400*30.5,formatter:function(D){return C.months[D.getUTCMonth()]}},{name:"week",seconds:86400*7,formatter:function(D){return C.formatDate(D)}},{name:"day",seconds:86400,formatter:function(D){return D.getUTCDate()}},{name:"6 hour",seconds:3600*6,formatter:function(D){return C.formatTime(D)}},{name:"hour",seconds:3600,formatter:function(D){return C.formatTime(D)}},{name:"15 minute",seconds:60*15,formatter:function(D){return C.formatTime(D)}},{name:"minute",seconds:60,formatter:function(D){return D.getUTCMinutes()}},{name:"15 second",seconds:15,formatter:function(D){return D.getUTCSeconds()+"s"}},{name:"second",seconds:1,formatter:function(D){return D.getUTCSeconds()+"s"}},{name:"decisecond",seconds:1/10,formatter:function(D){return D.getUTCMilliseconds()+"ms"}},{name:"centisecond",seconds:1/100,formatter:function(D){return D.getUTCMilliseconds()+"ms"}}];this.unit=function(D){return this.units.filter(function(E){return D==E.name}).shift()};this.formatDate=function(D){return B.time.format("%b %e")(D)};this.formatTime=function(D){return D.toUTCString().match(/(\d+:\d+):/)[1]};this.ceil=function(F,E){var H,G,I;if(E.name=="month"){H=new Date(F*1000);G=Date.UTC(H.getUTCFullYear(),H.getUTCMonth())/1000;if(G==F){return F}I=H.getUTCFullYear();var D=H.getUTCMonth();if(D==11){D=0;I=I+1}else{D+=1}return Date.UTC(I,D)/1000}if(E.name=="year"){H=new Date(F*1000);G=Date.UTC(H.getUTCFullYear(),0)/1000;if(G==F){return F}I=H.getUTCFullYear()+1;return Date.UTC(I,0)/1000}return Math.ceil(F/E.seconds)*E.seconds}};A.namespace("Rickshaw.Fixtures.Time.Local");A.Fixtures.Time.Local=function(){var C=this;this.months=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"];this.units=[{name:"decade",seconds:86400*365.25*10,formatter:function(D){return parseInt(D.getFullYear()/10,10)*10}},{name:"year",seconds:86400*365.25,formatter:function(D){return D.getFullYear()}},{name:"month",seconds:86400*30.5,formatter:function(D){return C.months[D.getMonth()]}},{name:"week",seconds:86400*7,formatter:function(D){return C.formatDate(D)}},{name:"day",seconds:86400,formatter:function(D){return D.getDate()}},{name:"6 hour",seconds:3600*6,formatter:function(D){return C.formatTime(D)}},{name:"hour",seconds:3600,formatter:function(D){return C.formatTime(D)}},{name:"15 minute",seconds:60*15,formatter:function(D){return C.formatTime(D)}},{name:"minute",seconds:60,formatter:function(D){return D.getMinutes()}},{name:"15 second",seconds:15,formatter:function(D){return D.getSeconds()+"s"}},{name:"second",seconds:1,formatter:function(D){return D.getSeconds()+"s"}},{name:"decisecond",seconds:1/10,formatter:function(D){return D.getMilliseconds()+"ms"}},{name:"centisecond",seconds:1/100,formatter:function(D){return D.getMilliseconds()+"ms"}}];this.unit=function(D){return this.units.filter(function(E){return D==E.name}).shift()};this.formatDate=function(D){return B.time.format("%b %e")(D)};this.formatTime=function(D){return D.toString().match(/(\d+:\d+):/)[1]};this.ceil=function(D,J){var K,F,I;if(J.name=="day"){var G=new Date((D+J.seconds-1)*1000);var H=new Date(0);H.setMilliseconds(0);H.setSeconds(0);H.setMinutes(0);H.setHours(0);H.setDate(G.getDate());H.setMonth(G.getMonth());H.setFullYear(G.getFullYear());return H.getTime()/1000}if(J.name=="month"){K=new Date(D*1000);F=new Date(K.getFullYear(),K.getMonth()).getTime()/1000;if(F==D){return D}I=K.getFullYear();var E=K.getMonth();if(E==11){E=0;I=I+1}else{E+=1}return new Date(I,E).getTime()/1000}if(J.name=="year"){K=new Date(D*1000);F=new Date(K.getUTCFullYear(),0).getTime()/1000;if(F==D){return D}I=K.getFullYear()+1;return new Date(I,0).getTime()/1000}return Math.ceil(D/J.seconds)*J.seconds}};A.namespace("Rickshaw.Fixtures.Number");A.Fixtures.Number.formatKMBT=function(D){var C=Math.abs(D);if(C>=1000000000000){return D/1000000000000+"T"}else{if(C>=1000000000){return D/1000000000+"B"}else{if(C>=1000000){return D/1000000+"M"}else{if(C>=1000){return D/1000+"K"}else{if(C<1&&D>0){return D.toFixed(2)}else{if(C===0){return""}else{return D}}}}}}};A.Fixtures.Number.formatBase1024KMGTP=function(D){var C=Math.abs(D);if(C>=1.12589990684262e+15){return D/1.12589990684262e+15+"P"}else{if(C>=1099511627776){return D/1099511627776+"T"}else{if(C>=1073741824){return D/1073741824+"G"}else{if(C>=1048576){return D/1048576+"M"}else{if(C>=1024){return D/1024+"K"}else{if(C<1&&D>0){return D.toFixed(2)}else{if(C===0){return""}else{return D}}}}}}}};A.namespace("Rickshaw.Color.Palette");A.Color.Palette=function(I){var H=new A.Fixtures.Color;I=I||{};this.schemes={};this.scheme=H.schemes[I.scheme]||I.scheme||H.schemes.colorwheel;this.runningIndex=0;this.generatorIndex=0;if(I.interpolatedStopCount){var D=this.scheme.length-1;var E,C,G=[];for(E=0;E<D;E++){G.push(this.scheme[E]);var F=B.interpolateHsl(this.scheme[E],this.scheme[E+1]);for(C=1;C<I.interpolatedStopCount;C++){G.push(F(1/I.interpolatedStopCount*C))}}G.push(this.scheme[this.scheme.length-1]);this.scheme=G}this.rotateCount=this.scheme.length;this.color=function(J){return this.scheme[J]||this.scheme[this.runningIndex++]||this.interpolateColor()||"#808080"};this.interpolateColor=function(){if(!Array.isArray(this.scheme)){return}var J;if(this.generatorIndex==this.rotateCount*2-1){J=B.interpolateHsl(this.scheme[this.generatorIndex],this.scheme[0])(0.5);this.generatorIndex=0;this.rotateCount*=2}else{J=B.interpolateHsl(this.scheme[this.generatorIndex],this.scheme[this.generatorIndex+1])(0.5);this.generatorIndex++}this.scheme.push(J);return J}};A.namespace("Rickshaw.Graph.Ajax");A.Graph.Ajax=A.Class.create({initialize:function(C){this.dataURL=C.dataURL;this.onData=C.onData||function(D){return D};this.onComplete=C.onComplete||function(){};this.onError=C.onError||function(){};this.args=C;this.request()},request:function(){jQuery.ajax({url:this.dataURL,dataType:"json",success:this.success.bind(this),error:this.error.bind(this)})},error:function(){console.log("error loading dataURL: "+this.dataURL);this.onError(this)},success:function(D,C){D=this.onData(D);this.args.series=this._splice({data:D,series:this.args.series});this.graph=this.graph||new A.Graph(this.args);this.graph.render();this.onComplete(this)},_splice:function(E){var C=E.data;var D=E.series;if(!E.series){return C}D.forEach(function(F){var G=F.key||F.name;if(!G){throw"series needs a key or a name"}C.forEach(function(I){var H=I.key||I.name;if(!H){throw"data needs a key or a name"}if(G==H){var J=["color","name","data"];J.forEach(function(K){if(I[K]){F[K]=I[K]}})}})});return D}});A.namespace("Rickshaw.Graph.Annotate");A.Graph.Annotate=function(E){var D=this.graph=E.graph;this.elements={intimeline:E.element};var C=this;this.data={};this.elements.intimeline.classList.add("rickshaw_annotation_intimeline");this.add=function(F,G,H){C.data[F]=C.data[F]||{boxes:[]};C.data[F].boxes.push({content:G,end:H})};this.update=function(){A.keys(C.data).forEach(function(G){var H=C.data[G];var F=C.graph.x(G);if(F<0||F>C.graph.x.range()[1]){if(H.element){H.line.classList.add("offscreen");H.element.style.display="none"}H.boxes.forEach(function(J){if(J.rangeElement){J.rangeElement.classList.add("offscreen")}});return}if(!H.element){var I=H.element=document.createElement("div");I.classList.add("annotation");this.elements.intimeline.appendChild(I);I.addEventListener("click",function(J){I.classList.toggle("active");H.line.classList.toggle("active");H.boxes.forEach(function(K){if(K.rangeElement){K.rangeElement.classList.toggle("active")}})},false)}H.element.style.left=F+"px";H.element.style.display="block";H.boxes.forEach(function(J){var N=J.element;if(!N){N=J.element=document.createElement("div");N.classList.add("content");N.innerHTML=J.content;H.element.appendChild(N);H.line=document.createElement("div");H.line.classList.add("annotation_line");C.graph.element.appendChild(H.line);if(J.end){J.rangeElement=document.createElement("div");J.rangeElement.classList.add("annotation_range");C.graph.element.appendChild(J.rangeElement)}}if(J.end){var M=F;var L=Math.min(C.graph.x(J.end),C.graph.x.range()[1]);if(M>L){L=F;M=Math.max(C.graph.x(J.end),C.graph.x.range()[0])}var K=L-M;J.rangeElement.style.left=M+"px";J.rangeElement.style.width=K+"px";J.rangeElement.classList.remove("offscreen")}H.line.classList.remove("offscreen");H.line.style.left=F+"px"})},this)};this.graph.onUpdate(function(){C.update()})};A.namespace("Rickshaw.Graph.Axis.Time");A.Graph.Axis.Time=function(E){var C=this;this.graph=E.graph;this.elements=[];this.ticksTreatment=E.ticksTreatment||"plain";this.fixedTimeUnit=E.timeUnit;var D=E.timeFixture||new A.Fixtures.Time;this.appropriateTimeUnit=function(){var G;var H=D.units;var I=this.graph.x.domain();var F=I[1]-I[0];H.forEach(function(J){if(Math.floor(F/J.seconds)>=2){G=G||J}});return G||D.units[D.units.length-1]};this.tickOffsets=function(){var L=this.graph.x.domain();var I=this.fixedTimeUnit||this.appropriateTimeUnit();var G=Math.ceil((L[1]-L[0])/I.seconds);var J=L[0];var H=[];for(var F=0;F<G;F++){var K=D.ceil(J,I);J=K+I.seconds/2;H.push({value:K,unit:I})}return H};this.render=function(){this.elements.forEach(function(G){G.parentNode.removeChild(G)});this.elements=[];var F=this.tickOffsets();F.forEach(function(G){if(C.graph.x(G.value)>C.graph.x.range()[1]){return}var I=document.createElement("div");I.style.left=C.graph.x(G.value)+"px";I.classList.add("x_tick");I.classList.add(C.ticksTreatment);var H=document.createElement("div");H.classList.add("title");H.innerHTML=G.unit.formatter(new Date(G.value*1000));I.appendChild(H);C.graph.element.appendChild(I);C.elements.push(I)})};this.graph.onUpdate(function(){C.render()})};A.namespace("Rickshaw.Graph.Axis.X");A.Graph.Axis.X=function(E){var C=this;var D=0.1;this.initialize=function(F){this.graph=F.graph;this.orientation=F.orientation||"top";this.pixelsPerTick=F.pixelsPerTick||75;if(F.ticks){this.staticTicks=F.ticks}if(F.tickValues){this.tickValues=F.tickValues}this.tickSize=F.tickSize||4;this.ticksTreatment=F.ticksTreatment||"plain";if(F.element){this.element=F.element;this._discoverSize(F.element,F);this.vis=B.select(F.element).append("svg:svg").attr("height",this.height).attr("width",this.width).attr("class","rickshaw_graph x_axis_d3");this.element=this.vis[0][0];this.element.style.position="relative";this.setSize({width:F.width,height:F.height})}else{this.vis=this.graph.vis}this.graph.onUpdate(function(){C.render()})};this.setSize=function(G){G=G||{};if(!this.element){return}this._discoverSize(this.element.parentNode,G);this.vis.attr("height",this.height).attr("width",this.width*(1+D));var F=Math.floor(this.width*D/2);this.element.style.left=-1*F+"px"};this.render=function(){if(this._renderWidth!==undefined&&this.graph.width!==this._renderWidth){this.setSize({auto:true})}var J=B.svg.axis().scale(this.graph.x).orient(this.orientation);J.tickFormat(E.tickFormat||function(K){return K});if(this.tickValues){J.tickValues(this.tickValues)}this.ticks=this.staticTicks||Math.floor(this.graph.width/this.pixelsPerTick);var F=Math.floor(this.width*D/2)||0;var H;if(this.orientation=="top"){var G=this.height||this.graph.height;H="translate("+F+","+G+")"}else{H="translate("+F+", 0)"}if(this.element){this.vis.selectAll("*").remove()}this.vis.append("svg:g").attr("class",["x_ticks_d3",this.ticksTreatment].join(" ")).attr("transform",H).call(J.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize));var I=(this.orientation=="bottom"?1:-1)*this.graph.height;this.graph.vis.append("svg:g").attr("class","x_grid_d3").call(J.ticks(this.ticks).tickSubdivide(0).tickSize(I)).selectAll("text").each(function(){this.parentNode.setAttribute("data-x-value",this.textContent)});this._renderHeight=this.graph.height};this._discoverSize=function(I,J){if(typeof window!=="undefined"){var G=window.getComputedStyle(I,null);var H=parseInt(G.getPropertyValue("height"),10);if(!J.auto){var F=parseInt(G.getPropertyValue("width"),10)}}this.width=(J.width||F||this.graph.width)*(1+D);this.height=J.height||H||40};this.initialize(E)};A.namespace("Rickshaw.Graph.Axis.Y");A.Graph.Axis.Y=A.Class.create({initialize:function(D){this.graph=D.graph;this.orientation=D.orientation||"right";this.pixelsPerTick=D.pixelsPerTick||75;if(D.ticks){this.staticTicks=D.ticks}if(D.tickValues){this.tickValues=D.tickValues}this.tickSize=D.tickSize||4;this.ticksTreatment=D.ticksTreatment||"plain";this.tickFormat=D.tickFormat||function(E){return E};this.berthRate=0.1;if(D.element){this.element=D.element;this.vis=B.select(D.element).append("svg:svg").attr("class","rickshaw_graph y_axis");this.element=this.vis[0][0];this.element.style.position="relative";this.setSize({width:D.width,height:D.height})}else{this.vis=this.graph.vis}var C=this;this.graph.onUpdate(function(){C.render()})},setSize:function(G){G=G||{};if(!this.element){return}if(typeof window!=="undefined"){var E=window.getComputedStyle(this.element.parentNode,null);var D=parseInt(E.getPropertyValue("width"),10);if(!G.auto){var F=parseInt(E.getPropertyValue("height"),10)}}this.width=G.width||D||this.graph.width*this.berthRate;this.height=G.height||F||this.graph.height;this.vis.attr("width",this.width).attr("height",this.height*(1+this.berthRate));var C=this.height*this.berthRate;if(this.orientation=="left"){this.element.style.top=-1*C+"px"}},render:function(){if(this._renderHeight!==undefined&&this.graph.height!==this._renderHeight){this.setSize({auto:true})}this.ticks=this.staticTicks||Math.floor(this.graph.height/this.pixelsPerTick);var C=this._drawAxis(this.graph.y);this._drawGrid(C);this._renderHeight=this.graph.height},_drawAxis:function(E){var F=B.svg.axis().scale(E).orient(this.orientation);F.tickFormat(this.tickFormat);if(this.tickValues){F.tickValues(this.tickValues)}if(this.orientation=="left"){var C=this.height*this.berthRate;var D="translate("+this.width+", "+C+")"}if(this.element){this.vis.selectAll("*").remove()}this.vis.append("svg:g").attr("class",["y_ticks",this.ticksTreatment].join(" ")).attr("transform",D).call(F.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize));return F},_drawGrid:function(D){var C=(this.orientation=="right"?1:-1)*this.graph.width;this.graph.vis.append("svg:g").attr("class","y_grid").call(D.ticks(this.ticks).tickSubdivide(0).tickSize(C)).selectAll("text").each(function(){this.parentNode.setAttribute("data-y-value",this.textContent)})}});A.namespace("Rickshaw.Graph.Axis.Y.Scaled");A.Graph.Axis.Y.Scaled=A.Class.create(A.Graph.Axis.Y,{initialize:function($super,C){if(typeof C.scale==="undefined"){throw new Error("Scaled requires scale")}this.scale=C.scale;if(typeof C.grid==="undefined"){this.grid=true}else{this.grid=C.grid}$super(C)},_drawAxis:function($super,D){var I=this.scale.domain();var G=this.graph.renderer.domain().y;var J=[Math.min.apply(Math,I),Math.max.apply(Math,I)];var F=B.scale.linear().domain([0,1]).range(J);var C=[F(G[0]),F(G[1])];var H=B.scale.linear().domain(J).range(C);var E=this.scale.copy().domain(I.map(H)).range(D.range());return $super(E)},_drawGrid:function($super,C){if(this.grid){$super(C)}}});A.namespace("Rickshaw.Graph.Behavior.Series.Highlight");A.Graph.Behavior.Series.Highlight=function(G){this.graph=G.graph;this.legend=G.legend;var D=this;var F={};var C=null;var E=G.disabledColor||function(H){return B.interpolateRgb(H,B.rgb("#d8d8d8"))(0.8).toString()};this.addHighlightEvents=function(H){H.element.addEventListener("mouseover",function(I){if(C){return}else{C=H}D.legend.lines.forEach(function(L){if(H===L){if(D.graph.renderer.unstack&&(L.series.renderer?L.series.renderer.unstack:true)){var J=D.graph.series.indexOf(L.series);L.originalIndex=J;var K=D.graph.series.splice(J,1)[0];D.graph.series.push(K)}return}F[L.series.name]=F[L.series.name]||L.series.color;L.series.color=E(L.series.color)});D.graph.update()},false);H.element.addEventListener("mouseout",function(I){if(!C){return}else{C=null}D.legend.lines.forEach(function(K){if(H===K&&K.hasOwnProperty("originalIndex")){var J=D.graph.series.pop();D.graph.series.splice(K.originalIndex,0,J);delete K.originalIndex}if(F[K.series.name]){K.series.color=F[K.series.name]}});D.graph.update()},false)};if(this.legend){this.legend.lines.forEach(function(H){D.addHighlightEvents(H)})}};A.namespace("Rickshaw.Graph.Behavior.Series.Order");A.Graph.Behavior.Series.Order=function(D){this.graph=D.graph;this.legend=D.legend;var C=this;if(typeof window.jQuery=="undefined"){throw"couldn't find jQuery at window.jQuery"}if(typeof window.jQuery.ui=="undefined"){throw"couldn't find jQuery UI at window.jQuery.ui"}jQuery(function(){jQuery(C.legend.list).sortable({containment:"parent",tolerance:"pointer",update:function(G,E){var H=[];jQuery(C.legend.list).find("li").each(function(J,I){if(!I.series){return}H.push(I.series)});for(var F=C.graph.series.length-1;F>=0;F--){C.graph.series[F]=H.shift()}C.graph.update()}});jQuery(C.legend.list).disableSelection()});this.graph.onUpdate(function(){var E=window.getComputedStyle(C.legend.element).height;C.legend.element.style.height=E})};A.namespace("Rickshaw.Graph.Behavior.Series.Toggle");A.Graph.Behavior.Series.Toggle=function(E){this.graph=E.graph;this.legend=E.legend;var C=this;this.addAnchor=function(G){var H=document.createElement("a");H.innerHTML="&#10004;";H.classList.add("action");G.element.insertBefore(H,G.element.firstChild);H.onclick=function(I){if(G.series.disabled){G.series.enable();G.element.classList.remove("disabled")}else{if(this.graph.series.filter(function(J){return !J.disabled}).length<=1){return}G.series.disable();G.element.classList.add("disabled")}}.bind(this);var F=G.element.getElementsByTagName("span")[0];F.onclick=function(J){var L=G.series.disabled;if(!L){for(var I=0;I<C.legend.lines.length;I++){var K=C.legend.lines[I];if(G.series===K.series){}else{if(K.series.disabled){}else{L=true;break}}}}if(L){G.series.enable();G.element.classList.remove("disabled");C.legend.lines.forEach(function(M){if(G.series===M.series){}else{M.series.disable();M.element.classList.add("disabled")}})}else{C.legend.lines.forEach(function(M){M.series.enable();M.element.classList.remove("disabled")})}}};if(this.legend){var D=jQuery;if(typeof D!="undefined"&&D(this.legend.list).sortable){D(this.legend.list).sortable({start:function(G,F){F.item.bind("no.onclick",function(H){H.preventDefault()})},stop:function(G,F){setTimeout(function(){F.item.unbind("no.onclick")},250)}})}this.legend.lines.forEach(function(F){C.addAnchor(F)})}this._addBehavior=function(){this.graph.series.forEach(function(F){F.disable=function(){if(C.graph.series.length<=1){throw"only one series left"}F.disabled=true;C.graph.update()};F.enable=function(){F.disabled=false;C.graph.update()}})};this._addBehavior();this.updateBehaviour=function(){this._addBehavior()}};A.namespace("Rickshaw.Graph.HoverDetail");A.Graph.HoverDetail=A.Class.create({initialize:function(E){var C=this.graph=E.graph;this.xFormatter=E.xFormatter||function(F){return new Date(F*1000).toUTCString()};this.yFormatter=E.yFormatter||function(F){return F===null?F:F.toFixed(2)};var D=this.element=document.createElement("div");D.className="detail";this.visible=true;C.element.appendChild(D);this.lastEvent=null;this._addListeners();this.onShow=E.onShow;this.onHide=E.onHide;this.onRender=E.onRender;this.formatter=E.formatter||this.formatter},formatter:function(F,E,G,C,H,D){return F.name+":&nbsp;"+H},update:function(C){C=C||this.lastEvent;if(!C){return}this.lastEvent=C;if(!C.target.nodeName.match(/^(path|svg|rect|circle)$/)){return}var E=this.graph;var F=C.offsetX||C.layerX;var D=C.offsetY||C.layerY;var G=0;var J=[];var K;this.graph.series.active().forEach(function(T){var M=this.graph.stackedData[G++];if(!M.length){return}var W=E.x.invert(F);var L=B.scale.linear().domain([M[0].x,M.slice(-1)[0].x]).range([0,M.length-1]);var O=Math.round(L(W));if(O==M.length-1){O--}var S=Math.min(O||0,M.length-1);for(var Q=O;Q<M.length-1;){if(!M[Q]||!M[Q+1]){break}if(M[Q].x<=W&&M[Q+1].x>W){S=Math.abs(W-M[Q].x)<Math.abs(W-M[Q+1].x)?Q:Q+1;break}if(M[Q+1].x<=W){Q++}else{Q--}}if(S<0){S=0}var P=M[S];var R=Math.sqrt(Math.pow(Math.abs(E.x(P.x)-F),2)+Math.pow(Math.abs(E.y(P.y+P.y0)-D),2));var V=T.xFormatter||this.xFormatter;var U=T.yFormatter||this.yFormatter;var N={formattedXValue:V(P.x),formattedYValue:U(T.scale?T.scale.invert(P.y):P.y),series:T,value:P,distance:R,order:G,name:T.name};if(!K||R<K.distance){K=N}J.push(N)},this);if(!K){return}K.active=true;var I=K.value.x;var H=K.formattedXValue;this.element.innerHTML="";this.element.style.left=E.x(I)+"px";this.visible&&this.render({points:J,detail:J,mouseX:F,mouseY:D,formattedXValue:H,domainX:I})},hide:function(){this.visible=false;this.element.classList.add("inactive");if(typeof this.onHide=="function"){this.onHide()}},show:function(){this.visible=true;this.element.classList.remove("inactive");if(typeof this.onShow=="function"){this.onShow()}},render:function(D){var E=this.graph;var M=D.points;var G=M.filter(function(Q){return Q.active}).shift();if(G.value.y===null){return}var I=G.formattedXValue;var N=G.formattedYValue;this.element.innerHTML="";this.element.style.left=E.x(G.value.x)+"px";var O=document.createElement("div");O.className="x_label";O.innerHTML=I;this.element.appendChild(O);var P=document.createElement("div");P.className="item";var K=G.series;var C=K.scale?K.scale.invert(G.value.y):G.value.y;P.innerHTML=this.formatter(K,G.value.x,C,I,N,G);P.style.top=this.graph.y(G.value.y0+G.value.y)+"px";this.element.appendChild(P);var F=document.createElement("div");F.className="dot";F.style.top=P.style.top;F.style.borderColor=K.color;this.element.appendChild(F);if(G.active){P.classList.add("active");F.classList.add("active")}var L=[O,P];L.forEach(function(Q){Q.classList.add("left")});this.show();var J=this._calcLayoutError(L);if(J>0){L.forEach(function(Q){Q.classList.remove("left");Q.classList.add("right")});var H=this._calcLayoutError(L);if(H>J){L.forEach(function(Q){Q.classList.remove("right");Q.classList.add("left")})}}if(typeof this.onRender=="function"){this.onRender(D)}},_calcLayoutError:function(C){var E=this.element.parentNode.getBoundingClientRect();var F=0;var D=C.forEach(function(G){var H=G.getBoundingClientRect();if(!H.width){return}if(H.right>E.right){F+=H.right-E.right}if(H.left<E.left){F+=E.left-H.left}});return F},_addListeners:function(){this.graph.element.addEventListener("mousemove",function(C){this.visible=true;this.update(C)}.bind(this),false);this.graph.onUpdate(function(){this.update()}.bind(this));this.graph.element.addEventListener("mouseout",function(C){if(C.relatedTarget&&!(C.relatedTarget.compareDocumentPosition(this.graph.element)&Node.DOCUMENT_POSITION_CONTAINS)){this.hide()}}.bind(this),false)}});A.namespace("Rickshaw.Graph.JSONP");A.Graph.JSONP=A.Class.create(A.Graph.Ajax,{request:function(){jQuery.ajax({url:this.dataURL,dataType:"jsonp",success:this.success.bind(this),error:this.error.bind(this)})}});A.namespace("Rickshaw.Graph.Legend");A.Graph.Legend=A.Class.create({className:"rickshaw_legend",initialize:function(C){this.element=C.element;this.graph=C.graph;this.naturalOrder=C.naturalOrder;this.element.classList.add(this.className);this.list=document.createElement("ul");this.element.appendChild(this.list);this.render();this.graph.onUpdate(function(){})},render:function(){var C=this;while(this.list.firstChild){this.list.removeChild(this.list.firstChild)}this.lines=[];var D=this.graph.series.map(function(E){return E});if(!this.naturalOrder){D=D.reverse()}D.forEach(function(E){C.addLine(E)})},addLine:function(F){var G=document.createElement("li");G.className="line";if(F.disabled){G.className+=" disabled"}if(F.className){B.select(G).classed(F.className,true)}var E=document.createElement("div");E.className="swatch";E.style.backgroundColor=F.color;G.appendChild(E);var C=document.createElement("span");C.className="label";C.innerHTML=F.name;G.appendChild(C);this.list.appendChild(G);G.series=F;if(F.noLegend){G.style.display="none"}var D={element:G,series:F};if(this.shelving){this.shelving.addAnchor(D);this.shelving.updateBehaviour()}if(this.highlighter){this.highlighter.addHighlightEvents(D)}this.lines.push(D);return G}});A.namespace("Rickshaw.Graph.RangeSlider");A.Graph.RangeSlider=A.Class.create({initialize:function(E){var D=this.element=E.element;var C=this.graph=E.graph;this.slideCallbacks=[];this.build();C.onUpdate(function(){this.update()}.bind(this))},build:function(){var E=this.element;var D=this.graph;var G=jQuery;var F=D.dataDomain();var C=this;G(function(){G(E).slider({range:true,min:F[0],max:F[1],values:[F[0],F[1]],slide:function(I,H){if(H.values[1]<=H.values[0]){return}D.window.xMin=H.values[0];D.window.xMax=H.values[1];D.update();var J=D.dataDomain();if(J[0]==H.values[0]){D.window.xMin=undefined}if(J[1]==H.values[1]){D.window.xMax=undefined}C.slideCallbacks.forEach(function(K){K(D,D.window.xMin,D.window.xMax)})}})});G(E)[0].style.width=D.width+"px"},update:function(){var E=this.element;var D=this.graph;var G=jQuery;var C=G(E).slider("option","values");var F=D.dataDomain();G(E).slider("option","min",F[0]);G(E).slider("option","max",F[1]);if(D.window.xMin==null){C[0]=F[0]}if(D.window.xMax==null){C[1]=F[1]}G(E).slider("option","values",C)},onSlide:function(C){this.slideCallbacks.push(C)}});A.namespace("Rickshaw.Graph.RangeSlider.Preview");A.Graph.RangeSlider.Preview=A.Class.create({initialize:function(C){if(!C.element){throw"Rickshaw.Graph.RangeSlider.Preview needs a reference to an element"}if(!C.graph&&!C.graphs){throw"Rickshaw.Graph.RangeSlider.Preview needs a reference to an graph or an array of graphs"}this.element=C.element;this.element.style.position="relative";this.graphs=C.graph?[C.graph]:C.graphs;this.defaults={height:75,width:400,gripperColor:undefined,frameTopThickness:3,frameHandleThickness:10,frameColor:"#d4d4d4",frameOpacity:1,minimumFrameWidth:0,heightRatio:0.2};this.heightRatio=C.heightRatio||this.defaults.heightRatio;this.defaults.gripperColor=B.rgb(this.defaults.frameColor).darker().toString();this.configureCallbacks=[];this.slideCallbacks=[];this.previews=[];if(!C.width){this.widthFromGraph=true}if(!C.height){this.heightFromGraph=true}if(this.widthFromGraph||this.heightFromGraph){this.graphs[0].onConfigure(function(){this.configure(C);this.render()}.bind(this))}C.width=C.width||this.graphs[0].width||this.defaults.width;C.height=C.height||this.graphs[0].height*this.heightRatio||this.defaults.height;this.configure(C);this.render()},onSlide:function(C){this.slideCallbacks.push(C)},onConfigure:function(C){this.configureCallbacks.push(C)},configure:function(C){this.config=this.config||{};this.configureCallbacks.forEach(function(D){D(C)});A.keys(this.defaults).forEach(function(D){this.config[D]=D in C?C[D]:D in this.config?this.config[D]:this.defaults[D]},this);if("width" in C||"height" in C){if(this.widthFromGraph){this.config.width=this.graphs[0].width}if(this.heightFromGraph){this.config.height=this.graphs[0].height*this.heightRatio;this.previewHeight=this.config.height}this.previews.forEach(function(E){var F=this.previewHeight/this.graphs.length-this.config.frameTopThickness*2;var G=this.config.width-this.config.frameHandleThickness*2;E.setSize({width:G,height:F});if(this.svg){var H=F+this.config.frameHandleThickness*2;var D=G+this.config.frameHandleThickness*2;this.svg.style("width",D+"px");this.svg.style("height",H+"px")}},this)}},render:function(){var D=this;this.svg=B.select(this.element).selectAll("svg.rickshaw_range_slider_preview").data([null]);this.previewHeight=this.config.height-this.config.frameTopThickness*2;this.previewWidth=this.config.width-this.config.frameHandleThickness*2;this.currentFrame=[0,this.previewWidth];var I=function(O,N){var K=A.extend({},O.config);var J=D.previewHeight/D.graphs.length;var M=O.renderer.name;A.extend(K,{element:this.appendChild(document.createElement("div")),height:J,width:D.previewWidth,series:O.series,renderer:M});var L=new A.Graph(K);D.previews.push(L);O.onUpdate(function(){L.render();D.render()});O.onConfigure(function(P){delete P.height;P.width=P.width-D.config.frameHandleThickness*2;L.configure(P);L.render()});L.render()};var C=B.select(this.element).selectAll("div.rickshaw_range_slider_preview_container").data(this.graphs);var H="translate("+this.config.frameHandleThickness+"px, "+this.config.frameTopThickness+"px)";C.enter().append("div").classed("rickshaw_range_slider_preview_container",true).style("-webkit-transform",H).style("-moz-transform",H).style("-ms-transform",H).style("transform",H).each(I);C.exit().remove();var F=this.graphs[0];var G=B.scale.linear().domain([0,this.previewWidth]).range(F.dataDomain());var E=[F.window.xMin,F.window.xMax];this.currentFrame[0]=E[0]===undefined?0:Math.round(G.invert(E[0]));if(this.currentFrame[0]<0){this.currentFrame[0]=0}this.currentFrame[1]=E[1]===undefined?this.previewWidth:G.invert(E[1]);if(this.currentFrame[1]-this.currentFrame[0]<D.config.minimumFrameWidth){this.currentFrame[1]=(this.currentFrame[0]||0)+D.config.minimumFrameWidth}this.svg.enter().append("svg").classed("rickshaw_range_slider_preview",true).style("height",this.config.height+"px").style("width",this.config.width+"px").style("position","absolute").style("top",0);this._renderDimming();this._renderFrame();this._renderGrippers();this._renderHandles();this._renderMiddle();this._registerMouseEvents()},_renderDimming:function(){var C=this.svg.selectAll("path.dimming").data([null]);C.enter().append("path").attr("fill","white").attr("fill-opacity","0.7").attr("fill-rule","evenodd").classed("dimming",true);var D="";D+=" M "+this.config.frameHandleThickness+" "+this.config.frameTopThickness;D+=" h "+this.previewWidth;D+=" v "+this.previewHeight;D+=" h "+-this.previewWidth;D+=" z ";D+=" M "+Math.max(this.currentFrame[0],this.config.frameHandleThickness)+" "+this.config.frameTopThickness;D+=" H "+Math.min(this.currentFrame[1]+this.config.frameHandleThickness*2,this.previewWidth+this.config.frameHandleThickness);D+=" v "+this.previewHeight;D+=" H "+Math.max(this.currentFrame[0],this.config.frameHandleThickness);D+=" z";C.attr("d",D)},_renderFrame:function(){var C=this.svg.selectAll("path.frame").data([null]);C.enter().append("path").attr("stroke","white").attr("stroke-width","1px").attr("stroke-linejoin","round").attr("fill",this.config.frameColor).attr("fill-opacity",this.config.frameOpacity).attr("fill-rule","evenodd").classed("frame",true);var D="";D+=" M "+this.currentFrame[0]+" 0";D+=" H "+(this.currentFrame[1]+this.config.frameHandleThickness*2);D+=" V "+this.config.height;D+=" H "+this.currentFrame[0];D+=" z";D+=" M "+(this.currentFrame[0]+this.config.frameHandleThickness)+" "+this.config.frameTopThickness;D+=" H "+(this.currentFrame[1]+this.config.frameHandleThickness);D+=" v "+this.previewHeight;D+=" H "+(this.currentFrame[0]+this.config.frameHandleThickness);D+=" z";C.attr("d",D)},_renderGrippers:function(){var C=this.svg.selectAll("path.gripper").data([null]);C.enter().append("path").attr("stroke",this.config.gripperColor).classed("gripper",true);var D="";[0.4,0.6].forEach(function(E){D+=" M "+Math.round(this.currentFrame[0]+this.config.frameHandleThickness*E)+" "+Math.round(this.config.height*0.3);D+=" V "+Math.round(this.config.height*0.7);D+=" M "+Math.round(this.currentFrame[1]+this.config.frameHandleThickness*(1+E))+" "+Math.round(this.config.height*0.3);D+=" V "+Math.round(this.config.height*0.7)}.bind(this));C.attr("d",D)},_renderHandles:function(){var C=this.svg.selectAll("rect.left_handle").data([null]);C.enter().append("rect").attr("width",this.config.frameHandleThickness).style("cursor","ew-resize").style("fill-opacity","0").classed("left_handle",true);C.attr("x",this.currentFrame[0]).attr("height",this.config.height);var D=this.svg.selectAll("rect.right_handle").data([null]);D.enter().append("rect").attr("width",this.config.frameHandleThickness).style("cursor","ew-resize").style("fill-opacity","0").classed("right_handle",true);D.attr("x",this.currentFrame[1]+this.config.frameHandleThickness).attr("height",this.config.height)},_renderMiddle:function(){var C=this.svg.selectAll("rect.middle_handle").data([null]);C.enter().append("rect").style("cursor","move").style("fill-opacity","0").classed("middle_handle",true);C.attr("width",Math.max(0,this.currentFrame[1]-this.currentFrame[0])).attr("x",this.currentFrame[0]+this.config.frameHandleThickness).attr("height",this.config.height)},_registerMouseEvents:function(){var C=B.select(this.element);var G={target:null,start:null,stop:null,left:false,right:false,rigid:false};var E=this;function D(Q,O){G.stop=E._getClientXFromEvent(B.event,G);var L=G.stop-G.start;var N=E.frameBeforeDrag.slice(0);var M=E.config.minimumFrameWidth;if(G.rigid){M=E.frameBeforeDrag[1]-E.frameBeforeDrag[0]}if(G.left){N[0]=Math.max(N[0]+L,0)}if(G.right){N[1]=Math.min(N[1]+L,E.previewWidth)}var P=N[1]-N[0];if(P<=M){if(G.left){N[0]=N[1]-M}if(G.right){N[1]=N[0]+M}if(N[0]<=0){N[1]-=N[0];N[0]=0}if(N[1]>=E.previewWidth){N[0]-=N[1]-E.previewWidth;N[1]=E.previewWidth}}E.graphs.forEach(function(S){var T=B.scale.linear().interpolate(B.interpolateNumber).domain([0,E.previewWidth]).range(S.dataDomain());var R=[T(N[0]),T(N[1])];E.slideCallbacks.forEach(function(U){U(S,R[0],R[1])});if(N[0]===0){R[0]=undefined}if(N[1]===E.previewWidth){R[1]=undefined}S.window.xMin=R[0];S.window.xMax=R[1];S.update()})}function H(){G.target=B.event.target;G.start=E._getClientXFromEvent(B.event,G);E.frameBeforeDrag=E.currentFrame.slice();B.event.preventDefault?B.event.preventDefault():B.event.returnValue=false;B.select(document).on("mousemove.rickshaw_range_slider_preview",D);B.select(document).on("mouseup.rickshaw_range_slider_preview",I);B.select(document).on("touchmove.rickshaw_range_slider_preview",D);B.select(document).on("touchend.rickshaw_range_slider_preview",I);B.select(document).on("touchcancel.rickshaw_range_slider_preview",I)}function J(M,L){G.left=true;H()}function K(M,L){G.right=true;H()}function F(M,L){G.left=true;G.right=true;G.rigid=true;H()}function I(M,L){B.select(document).on("mousemove.rickshaw_range_slider_preview",null);B.select(document).on("mouseup.rickshaw_range_slider_preview",null);B.select(document).on("touchmove.rickshaw_range_slider_preview",null);B.select(document).on("touchend.rickshaw_range_slider_preview",null);B.select(document).on("touchcancel.rickshaw_range_slider_preview",null);delete E.frameBeforeDrag;G.left=false;G.right=false;G.rigid=false}C.select("rect.left_handle").on("mousedown",J);C.select("rect.right_handle").on("mousedown",K);C.select("rect.middle_handle").on("mousedown",F);C.select("rect.left_handle").on("touchstart",J);C.select("rect.right_handle").on("touchstart",K);C.select("rect.middle_handle").on("touchstart",F)},_getClientXFromEvent:function(E,C){switch(E.type){case"touchstart":case"touchmove":var G=E.changedTouches;var F=null;for(var D=0;D<G.length;D++){if(G[D].target===C.target){F=G[D];break}}return F!==null?F.clientX:undefined;default:return E.clientX}}});A.namespace("Rickshaw.Graph.Renderer");A.Graph.Renderer=A.Class.create({initialize:function(C){this.graph=C.graph;this.tension=C.tension||this.tension;this.configure(C)},seriesPathFactory:function(){},seriesStrokeFactory:function(){},defaults:function(){return{tension:0.8,strokeWidth:2,unstack:true,padding:{top:0.01,right:0,bottom:0.01,left:0},stroke:false,fill:false}},domain:function(H){var C=H||this.graph.stackedData||this.graph.stackData();var E=+Infinity;var D=-Infinity;var G=+Infinity;var F=-Infinity;C.forEach(function(I){I.forEach(function(J){if(J.y==null){return}var K=J.y+J.y0;if(K<G){G=K}if(K>F){F=K}});if(!I.length){return}if(I[0].x<E){E=I[0].x}if(I[I.length-1].x>D){D=I[I.length-1].x}});E-=(D-E)*this.padding.left;D+=(D-E)*this.padding.right;G=this.graph.min==="auto"?G:this.graph.min||0;F=this.graph.max===undefined?F:this.graph.max;if(this.graph.min==="auto"||G<0){G-=(F-G)*this.padding.bottom}if(this.graph.max===undefined){F+=(F-G)*this.padding.top}return{x:[E,D],y:[G,F]}},render:function(C){C=C||{};var E=this.graph;var J=C.series||E.series;var G=C.vis||E.vis;G.selectAll("*").remove();var F=J.filter(function(K){return !K.disabled}).map(function(K){return K.stack});var D=G.selectAll("path.path").data(F).enter().append("svg:path").classed("path",true).attr("d",this.seriesPathFactory());if(this.stroke){var I=G.selectAll("path.stroke").data(F).enter().append("svg:path").classed("stroke",true).attr("d",this.seriesStrokeFactory())}var H=0;J.forEach(function(K){if(K.disabled){return}K.path=D[0][H];if(this.stroke){K.stroke=I[0][H]}this._styleSeries(K);H++},this)},_styleSeries:function(E){var C=this.fill?E.color:"none";var D=this.stroke?E.color:"none";E.path.setAttribute("fill",C);E.path.setAttribute("stroke",D);E.path.setAttribute("stroke-width",this.strokeWidth);if(E.className){B.select(E.path).classed(E.className,true)}if(E.className&&this.stroke){B.select(E.stroke).classed(E.className,true)}},configure:function(C){C=C||{};A.keys(this.defaults()).forEach(function(D){if(!C.hasOwnProperty(D)){this[D]=this[D]||this.graph[D]||this.defaults()[D];return}if(typeof this.defaults()[D]=="object"){A.keys(this.defaults()[D]).forEach(function(E){this[D][E]=C[D][E]!==undefined?C[D][E]:this[D][E]!==undefined?this[D][E]:this.defaults()[D][E]},this)}else{this[D]=C[D]!==undefined?C[D]:this[D]!==undefined?this[D]:this.graph[D]!==undefined?this.graph[D]:this.defaults()[D]}},this)},setStrokeWidth:function(C){if(C!==undefined){this.strokeWidth=C}},setTension:function(C){if(C!==undefined){this.tension=C}}});A.namespace("Rickshaw.Graph.Renderer.Line");A.Graph.Renderer.Line=A.Class.create(A.Graph.Renderer,{name:"line",defaults:function($super){return A.extend($super(),{unstack:true,fill:false,stroke:true})},seriesPathFactory:function(){var C=this.graph;var D=B.svg.line().x(function(E){return C.x(E.x)}).y(function(E){return C.y(E.y)}).interpolate(this.graph.interpolation).tension(this.tension);D.defined&&D.defined(function(E){return E.y!==null});return D}});A.namespace("Rickshaw.Graph.Renderer.Stack");A.Graph.Renderer.Stack=A.Class.create(A.Graph.Renderer,{name:"stack",defaults:function($super){return A.extend($super(),{fill:true,stroke:false,unstack:false})},seriesPathFactory:function(){var C=this.graph;var D=B.svg.area().x(function(E){return C.x(E.x)}).y0(function(E){return C.y(E.y0)}).y1(function(E){return C.y(E.y+E.y0)}).interpolate(this.graph.interpolation).tension(this.tension);D.defined&&D.defined(function(E){return E.y!==null});return D}});A.namespace("Rickshaw.Graph.Renderer.Bar");A.Graph.Renderer.Bar=A.Class.create(A.Graph.Renderer,{name:"bar",defaults:function($super){var C=A.extend($super(),{gapSize:0.05,unstack:false});delete C.tension;return C},initialize:function($super,C){C=C||{};this.gapSize=C.gapSize||this.gapSize;$super(C)},domain:function($super){var D=$super();var C=this._frequentInterval(this.graph.stackedData.slice(-1).shift());D.x[1]+=Number(C.magnitude);return D},barWidth:function(D){var C=this._frequentInterval(D.stack);var E=this.graph.x.magnitude(C.magnitude)*(1-this.gapSize);return E},render:function(E){E=E||{};var F=this.graph;var J=E.series||F.series;var H=E.vis||F.vis;H.selectAll("*").remove();var G=this.barWidth(J.active()[0]);var C=0;var D=J.filter(function(L){return !L.disabled}).length;var K=this.unstack?G/D:G;var I=function(M){var L=[1,0,0,M.y<0?-1:1,0,M.y<0?F.y.magnitude(Math.abs(M.y))*2:0];return"matrix("+L.join(",")+")"};J.forEach(function(M){if(M.disabled){return}var N=this.barWidth(M);var L=H.selectAll("path").data(M.stack.filter(function(O){return O.y!==null})).enter().append("svg:rect").attr("x",function(O){return F.x(O.x)+C}).attr("y",function(O){return F.y(O.y0+Math.abs(O.y))*(O.y<0?-1:1)}).attr("width",K).attr("height",function(O){return F.y.magnitude(Math.abs(O.y))}).attr("transform",I);Array.prototype.forEach.call(L[0],function(O){O.setAttribute("fill",M.color)});if(this.unstack){C+=K}},this)},_frequentInterval:function(G){var E={};for(var C=0;C<G.length-1;C++){var D=G[C+1].x-G[C].x;E[D]=E[D]||0;E[D]++}var F={count:0,magnitude:1};A.keys(E).forEach(function(H){if(F.count<E[H]){F={count:E[H],magnitude:H}}});return F}});A.namespace("Rickshaw.Graph.Renderer.Area");A.Graph.Renderer.Area=A.Class.create(A.Graph.Renderer,{name:"area",defaults:function($super){return A.extend($super(),{unstack:false,fill:false,stroke:false})},seriesPathFactory:function(){var C=this.graph;var D=B.svg.area().x(function(E){return C.x(E.x)}).y0(function(E){return C.y(E.y0)}).y1(function(E){return C.y(E.y+E.y0)}).interpolate(C.interpolation).tension(this.tension);D.defined&&D.defined(function(E){return E.y!==null});return D},seriesStrokeFactory:function(){var C=this.graph;var D=B.svg.line().x(function(E){return C.x(E.x)}).y(function(E){return C.y(E.y+E.y0)}).interpolate(C.interpolation).tension(this.tension);D.defined&&D.defined(function(E){return E.y!==null});return D},render:function(C){C=C||{};var D=this.graph;var I=C.series||D.series;var F=C.vis||D.vis;F.selectAll("*").remove();var H=this.unstack?"append":"insert";var E=I.filter(function(K){return !K.disabled}).map(function(K){return K.stack});var J=F.selectAll("path").data(E).enter()[H]("svg:g","g");J.append("svg:path").attr("d",this.seriesPathFactory()).attr("class","area");if(this.stroke){J.append("svg:path").attr("d",this.seriesStrokeFactory()).attr("class","line")}var G=0;I.forEach(function(K){if(K.disabled){return}K.path=J[0][G++];this._styleSeries(K)},this)},_styleSeries:function(C){if(!C.path){return}B.select(C.path).select(".area").attr("fill",C.color);if(this.stroke){B.select(C.path).select(".line").attr("fill","none").attr("stroke",C.stroke||B.interpolateRgb(C.color,"black")(0.125)).attr("stroke-width",this.strokeWidth)}if(C.className){C.path.setAttribute("class",C.className)}}});A.namespace("Rickshaw.Graph.Renderer.ScatterPlot");A.Graph.Renderer.ScatterPlot=A.Class.create(A.Graph.Renderer,{name:"scatterplot",defaults:function($super){return A.extend($super(),{unstack:true,fill:true,stroke:false,padding:{top:0.01,right:0.01,bottom:0.01,left:0.01},dotSize:4})},initialize:function($super,C){$super(C)},render:function(G){G=G||{};var C=this.graph;var E=G.series||C.series;var F=G.vis||C.vis;var D=this.dotSize;F.selectAll("*").remove();E.forEach(function(I){if(I.disabled){return}var H=F.selectAll("path").data(I.stack.filter(function(J){return J.y!==null})).enter().append("svg:circle").attr("cx",function(J){return C.x(J.x)}).attr("cy",function(J){return C.y(J.y)}).attr("r",function(J){return"r" in J?J.r:D});if(I.className){H.classed(I.className,true)}Array.prototype.forEach.call(H[0],function(J){J.setAttribute("fill",I.color)})},this)}});A.namespace("Rickshaw.Graph.Renderer.Multi");A.Graph.Renderer.Multi=A.Class.create(A.Graph.Renderer,{name:"multi",initialize:function($super,C){$super(C)},defaults:function($super){return A.extend($super(),{unstack:true,fill:false,stroke:true})},configure:function($super,C){C=C||{};this.config=C;$super(C)},domain:function($super){this.graph.stackData();var D=[];var C=this._groups();this._stack(C);C.forEach(function(I){var K=I.series.filter(function(L){return !L.disabled}).map(function(L){return L.stack});if(!K.length){return}var J=null;if(I.renderer&&I.renderer.domain){J=I.renderer.domain(K)}else{J=$super(K)}D.push(J)});var F=B.min(D.map(function(I){return I.x[0]}));var E=B.max(D.map(function(I){return I.x[1]}));var H=B.min(D.map(function(I){return I.y[0]}));var G=B.max(D.map(function(I){return I.y[1]}));return{x:[F,E],y:[H,G]}},_groups:function(){var D=this.graph;var E={};D.series.forEach(function(I){if(I.disabled){return}if(!E[I.renderer]){var F="http://www.w3.org/2000/svg";var J=document.createElementNS(F,"g");D.vis[0][0].appendChild(J);var H=D._renderers[I.renderer];var G={};var K=[this.defaults(),H.defaults(),this.config,this.graph];K.forEach(function(L){A.extend(G,L)});H.configure(G);E[I.renderer]={renderer:H,series:[],vis:B.select(J)}}E[I.renderer].series.push(I)},this);var C=[];Object.keys(E).forEach(function(F){var G=E[F];C.push(G)});return C},_stack:function(C){C.forEach(function(D){var G=D.series.filter(function(I){return !I.disabled});var H=G.map(function(I){return I.stack});if(!D.renderer.unstack){var E=B.layout.stack();var F=A.clone(E(H));G.forEach(function(J,I){J._stack=A.clone(F[I])})}},this);return C},render:function(){this.graph.series.forEach(function(D){if(!D.renderer){throw new Error("Each series needs a renderer for graph 'multi' renderer")}});this.graph.vis.selectAll("*").remove();var C=this._groups();C=this._stack(C);C.forEach(function(D){var E=D.series.filter(function(F){return !F.disabled});E.active=function(){return E};D.renderer.render({series:E,vis:D.vis});E.forEach(function(F){F.stack=F._stack||F.stack||F.data})})}});A.namespace("Rickshaw.Graph.Renderer.LinePlot");A.Graph.Renderer.LinePlot=A.Class.create(A.Graph.Renderer,{name:"lineplot",defaults:function($super){return A.extend($super(),{unstack:true,fill:false,stroke:true,padding:{top:0.01,right:0.01,bottom:0.01,left:0.01},dotSize:3,strokeWidth:2})},seriesPathFactory:function(){var C=this.graph;var D=B.svg.line().x(function(E){return C.x(E.x)}).y(function(E){return C.y(E.y)}).interpolate(this.graph.interpolation).tension(this.tension);D.defined&&D.defined(function(E){return E.y!==null});return D},render:function(D){D=D||{};var E=this.graph;var I=D.series||E.series;var G=D.vis||E.vis;var C=this.dotSize;G.selectAll("*").remove();var F=I.filter(function(K){return !K.disabled}).map(function(K){return K.stack});var J=G.selectAll("path").data(F).enter().append("svg:path").attr("d",this.seriesPathFactory());var H=0;I.forEach(function(K){if(K.disabled){return}K.path=J[0][H++];this._styleSeries(K)},this);I.forEach(function(L){if(L.disabled){return}var K=G.selectAll("x").data(L.stack.filter(function(M){return M.y!==null})).enter().append("svg:circle").attr("cx",function(M){return E.x(M.x)}).attr("cy",function(M){return E.y(M.y)}).attr("r",function(M){return"r" in M?M.r:C});Array.prototype.forEach.call(K[0],function(M){if(!M){return}M.setAttribute("data-color",L.color);M.setAttribute("fill","white");M.setAttribute("stroke",L.color);M.setAttribute("stroke-width",this.strokeWidth)}.bind(this))},this)}});A.namespace("Rickshaw.Graph.Smoother");A.Graph.Smoother=A.Class.create({initialize:function(C){this.graph=C.graph;this.element=C.element;this.aggregationScale=1;this.build();this.graph.stackData.hooks.data.push({name:"smoother",orderPosition:50,f:this.transformer.bind(this)})},build:function(){var C=this;var D=jQuery;if(this.element){D(function(){D(C.element).slider({min:1,max:100,slide:function(F,E){C.setScale(E.value);C.graph.update()}})})}},setScale:function(C){if(C<1){throw"scale out of range: "+C}this.aggregationScale=C;this.graph.update()},transformer:function(D){if(this.aggregationScale==1){return D}var C=[];D.forEach(function(H){var E=[];while(H.length){var F=0,G=0;var I=H.splice(0,this.aggregationScale);I.forEach(function(J){F+=J.x/I.length;G+=J.y/I.length});E.push({x:F,y:G})}C.push(E)}.bind(this));return C}});A.namespace("Rickshaw.Graph.Socketio");A.Graph.Socketio=A.Class.create(A.Graph.Ajax,{request:function(){var D=io.connect(this.dataURL);var C=this;D.on("rickshaw",function(E){C.success(E)})}});A.namespace("Rickshaw.Series");A.Series=A.Class.create(Array,{initialize:function(F,E,D){D=D||{};this.palette=new A.Color.Palette(E);this.timeBase=typeof D.timeBase==="undefined"?Math.floor((new Date).getTime()/1000):D.timeBase;var C=typeof D.timeInterval=="undefined"?1000:D.timeInterval;this.setTimeInterval(C);if(F&&typeof F=="object"&&Array.isArray(F)){F.forEach(function(G){this.addItem(G)},this)}},addItem:function(C){if(typeof C.name==="undefined"){throw"addItem() needs a name"}C.color=C.color||this.palette.color(C.name);C.data=C.data||[];if(C.data.length===0&&this.length&&this.getIndex()>0){this[0].data.forEach(function(D){C.data.push({x:D.x,y:0})})}else{if(C.data.length===0){C.data.push({x:this.timeBase-(this.timeInterval||0),y:0})}}this.push(C);if(this.legend){this.legend.addLine(this.itemByName(C.name))}},addData:function(E,C){var D=this.getIndex();A.keys(E).forEach(function(F){if(!this.itemByName(F)){this.addItem({name:F})}},this);this.forEach(function(F){F.data.push({x:C||(D*this.timeInterval||1)+this.timeBase,y:E[F.name]||0})},this)},getIndex:function(){return this[0]&&this[0].data&&this[0].data.length?this[0].data.length:0},itemByName:function(D){for(var C=0;C<this.length;C++){if(this[C].name==D){return this[C]}}},setTimeInterval:function(C){this.timeInterval=C/1000},setTimeBase:function(C){this.timeBase=C},dump:function(){var C={timeBase:this.timeBase,timeInterval:this.timeInterval,items:[]};this.forEach(function(E){var D={color:E.color,name:E.name,data:[]};E.data.forEach(function(F){D.data.push({x:F.x,y:F.y})});C.items.push(D)});return C},load:function(C){if(C.timeInterval){this.timeInterval=C.timeInterval}if(C.timeBase){this.timeBase=C.timeBase}if(C.items){C.items.forEach(function(D){this.push(D);if(this.legend){this.legend.addLine(this.itemByName(D.name))}},this)}}});A.Series.zeroFill=function(C){A.Series.fill(C,0)};A.Series.fill=function(F,C){var E;var D=0;var G=F.map(function(H){return H.data});while(D<Math.max.apply(null,G.map(function(H){return H.length}))){E=Math.min.apply(null,G.filter(function(H){return H[D]}).map(function(H){return H[D].x}));G.forEach(function(H){if(!H[D]||H[D].x!=E){H.splice(D,0,{x:E,y:C})}});D++}};A.namespace("Rickshaw.Series.FixedDuration");A.Series.FixedDuration=A.Class.create(A.Series,{initialize:function(F,E,D){D=D||{};if(typeof D.timeInterval==="undefined"){throw new Error("FixedDuration series requires timeInterval")}if(typeof D.maxDataPoints==="undefined"){throw new Error("FixedDuration series requires maxDataPoints")}this.palette=new A.Color.Palette(E);this.timeBase=typeof D.timeBase==="undefined"?Math.floor((new Date).getTime()/1000):D.timeBase;this.setTimeInterval(D.timeInterval);if(this[0]&&this[0].data&&this[0].data.length){this.currentSize=this[0].data.length;this.currentIndex=this[0].data.length}else{this.currentSize=0;this.currentIndex=0}this.maxDataPoints=D.maxDataPoints;if(F&&typeof F=="object"&&Array.isArray(F)){F.forEach(function(G){this.addItem(G)},this);this.currentSize+=1;this.currentIndex+=1}this.timeBase-=(this.maxDataPoints-this.currentSize)*this.timeInterval;if(typeof this.maxDataPoints!=="undefined"&&this.currentSize<this.maxDataPoints){for(var C=this.maxDataPoints-this.currentSize-1;C>1;C--){this.currentSize+=1;this.currentIndex+=1;this.forEach(function(G){G.data.unshift({x:((C-1)*this.timeInterval||1)+this.timeBase,y:0,i:C})},this)}}},addData:function($super,D,C){$super(D,C);this.currentSize+=1;this.currentIndex+=1;if(this.maxDataPoints!==undefined){while(this.currentSize>this.maxDataPoints){this.dropData()}}},dropData:function(){this.forEach(function(C){C.data.splice(0,1)});this.currentSize-=1},getIndex:function(){return this.currentIndex}});return A});