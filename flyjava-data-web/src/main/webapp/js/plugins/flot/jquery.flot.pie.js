(function(C){function B(D){var I=null;var b=null;var h=null;var c=null;var M=null;var e=0;var J=true;var P=10;var F=0.95;var T=0;var L=false;var Y=false;var R=[];D.hooks.processOptions.push(g);D.hooks.bindEvents.push(a);function g(m,l){if(l.series.pie.show){l.grid.show=false;if(l.series.pie.label.show=="auto"){if(l.legend.show){l.series.pie.label.show=false}else{l.series.pie.label.show=true}}if(l.series.pie.radius=="auto"){if(l.series.pie.label.show){l.series.pie.radius=3/4}else{l.series.pie.radius=1}}if(l.series.pie.tilt>1){l.series.pie.tilt=1}if(l.series.pie.tilt<0){l.series.pie.tilt=0}m.hooks.processDatapoints.push(H);m.hooks.drawOverlay.push(X);m.hooks.draw.push(N)}}function a(n,m){var l=n.getOptions();if(l.series.pie.show&&l.grid.hoverable){m.unbind("mousemove").mousemove(U)}if(l.series.pie.show&&l.grid.clickable){m.unbind("click").click(S)}}function Z(l){var n="";function m(p,q){if(!q){q=0}for(var o=0;o<p.length;++o){for(var r=0;r<q;r++){n+="\t"}if(typeof p[o]=="object"){n+=""+o+":\n";m(p[o],q+1)}else{n+=""+o+": "+p[o]+"\n"}}}m(l);alert(n)}function V(n){for(var l=0;l<n.length;++l){var m=parseFloat(n[l].data[0][1]);if(m){e+=m}}}function H(m,n,o,l){if(!L){L=true;I=m.getCanvas();b=C(I).parent();A=m.getOptions();m.setData(K(m.getData()))}}function d(){T=b.children().filter(".legend").children().width();h=Math.min(I.width,(I.height/A.series.pie.tilt))/2;M=(I.height/2)+A.series.pie.offset.top;c=(I.width/2);if(A.series.pie.offset.left=="auto"){if(A.legend.position.match("w")){c+=T/2}else{c-=T/2}}else{c+=A.series.pie.offset.left}if(c<h){c=h}else{if(c>I.width-h){c=I.width-h}}}function k(m){for(var l=0;l<m.length;++l){if(typeof(m[l].data)=="number"){m[l].data=[[1,m[l].data]]}else{if(typeof(m[l].data)=="undefined"||typeof(m[l].data[0])=="undefined"){if(typeof(m[l].data)!="undefined"&&typeof(m[l].data.label)!="undefined"){m[l].label=m[l].data.label}m[l].data=[[1,0]]}}}return m}function K(q){q=k(q);V(q);var n=0;var l=0;var p=A.series.pie.combine.color;var o=[];for(var m=0;m<q.length;++m){q[m].data[0][1]=parseFloat(q[m].data[0][1]);if(!q[m].data[0][1]){q[m].data[0][1]=0}if(q[m].data[0][1]/e<=A.series.pie.combine.threshold){n+=q[m].data[0][1];l++;if(!p){p=q[m].color}}else{o.push({data:[[1,q[m].data[0][1]]],color:q[m].color,label:q[m].label,angle:(q[m].data[0][1]*(Math.PI*2))/e,percent:(q[m].data[0][1]/e*100)})}}if(l>0){o.push({data:[[1,n]],color:p,label:A.series.pie.combine.label,angle:(n*(Math.PI*2))/e,percent:(n/e*100)})}return o}function N(o,n){if(!b){return}ctx=n;d();var l=o.getData();var m=0;while(J&&m<P){J=false;if(m>0){h*=F}m+=1;q();if(A.series.pie.tilt<=0.8){r()}p()}if(m>=P){q();b.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>')}if(o.setSeries&&o.insertLegend){o.setSeries(l);o.insertLegend()}function q(){ctx.clearRect(0,0,I.width,I.height);b.children().filter(".pieLabel, .pieLabelBackground").remove()}function r(){var u=5;var v=15;var t=10;var z=0.02;if(A.series.pie.radius>1){var w=A.series.pie.radius}else{var w=h*A.series.pie.radius}if(w>=(I.width/2)-u||w*A.series.pie.tilt>=(I.height/2)-v||w<=t){return}ctx.save();ctx.translate(u,v);ctx.globalAlpha=z;ctx.fillStyle="#000";ctx.translate(c,M);ctx.scale(1,A.series.pie.tilt);for(var s=1;s<=t;s++){ctx.beginPath();ctx.arc(0,0,w,0,Math.PI*2,false);ctx.fill();w-=s}ctx.restore()}function p(){startAngle=Math.PI*A.series.pie.startAngle;if(A.series.pie.radius>1){var t=A.series.pie.radius}else{var t=h*A.series.pie.radius}ctx.save();ctx.translate(c,M);ctx.scale(1,A.series.pie.tilt);ctx.save();var v=startAngle;for(var s=0;s<l.length;++s){l[s].startAngle=v;u(l[s].angle,l[s].color,true)}ctx.restore();ctx.save();ctx.lineWidth=A.series.pie.stroke.width;v=startAngle;for(var s=0;s<l.length;++s){u(l[s].angle,A.series.pie.stroke.color,false)}ctx.restore();E(ctx);if(A.series.pie.label.show){w()}ctx.restore();function u(Ab,Aa,z){if(Ab<=0){return}if(z){ctx.fillStyle=Aa}else{ctx.strokeStyle=Aa;ctx.lineJoin="round"}ctx.beginPath();if(Math.abs(Ab-Math.PI*2)>1e-09){ctx.moveTo(0,0)}else{if(C.browser.msie){Ab-=0.0001}}ctx.arc(0,0,t,v,v+Ab,false);ctx.closePath();v+=Ab;if(z){ctx.fill()}else{ctx.stroke()}}function w(){var Ac=startAngle;if(A.series.pie.label.radius>1){var Ab=A.series.pie.label.radius}else{var Ab=h*A.series.pie.label.radius}for(var z=0;z<l.length;++z){if(l[z].percent>=A.series.pie.label.threshold*100){Aa(l[z],Ac,z)}Ac+=l[z].angle}function Aa(Ad,Ar,Ag){if(Ad.data[0][1]==0){return}var Ao=A.legend.labelFormatter,Ak,Aq=A.series.pie.label.formatter;if(Ao){Ak=Ao(Ad.label,Ad)}else{Ak=Ad.label}if(Aq){Ak=Aq(Ak,Ad)}var Aj=((Ar+Ad.angle)+Ar)/2;var An=c+Math.round(Math.cos(Aj)*Ab);var Ae=M+Math.round(Math.sin(Aj)*Ab)*A.series.pie.tilt;var Ap='<span class="pieLabel" id="pieLabel'+Ag+'" style="position:absolute;top:'+Ae+"px;left:"+An+'px;">'+Ak+"</span>";b.append(Ap);var Am=b.children("#pieLabel"+Ag);var Ah=(Ae-Am.height()/2);var Ai=(An-Am.width()/2);Am.css("top",Ah);Am.css("left",Ai);if(0-Ah>0||0-Ai>0||I.height-(Ah+Am.height())<0||I.width-(Ai+Am.width())<0){J=true}if(A.series.pie.label.background.opacity!=0){var Af=A.series.pie.label.background.color;if(Af==null){Af=Ad.color}var Al="top:"+Ah+"px;left:"+Ai+"px;";C('<div class="pieLabelBackground" style="position:absolute;width:'+Am.width()+"px;height:"+Am.height()+"px;"+Al+"background-color:"+Af+';"> </div>').insertBefore(Am).css("opacity",A.series.pie.label.background.opacity)}}}}}function E(l){if(A.series.pie.innerRadius>0){l.save();innerRadius=A.series.pie.innerRadius>1?A.series.pie.innerRadius:h*A.series.pie.innerRadius;l.globalCompositeOperation="destination-out";l.beginPath();l.fillStyle=A.series.pie.stroke.color;l.arc(0,0,innerRadius,0,Math.PI*2,false);l.fill();l.closePath();l.restore();l.save();l.beginPath();l.strokeStyle=A.series.pie.stroke.color;l.arc(0,0,innerRadius,0,Math.PI*2,false);l.stroke();l.closePath();l.restore()}}function O(m,o){for(var q=false,n=-1,p=m.length,r=p-1;++n<p;r=n){((m[n][1]<=o[1]&&o[1]<m[r][1])||(m[r][1]<=o[1]&&o[1]<m[n][1]))&&(o[0]<(m[r][0]-m[n][0])*(o[1]-m[n][1])/(m[r][1]-m[n][1])+m[n][0])&&(q=!q)}return q}function W(q,r){var l=D.getData(),o=D.getOptions(),p=o.series.pie.radius>1?o.series.pie.radius:h*o.series.pie.radius;for(var m=0;m<l.length;++m){var n=l[m];if(n.pie.show){ctx.save();ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,p,n.startAngle,n.startAngle+n.angle,false);ctx.closePath();x=q-c;y=r-M;if(ctx.isPointInPath){if(ctx.isPointInPath(q-c,r-M)){ctx.restore();return{datapoint:[n.percent,n.data],dataIndex:0,series:n,seriesIndex:m}}}else{p1X=(p*Math.cos(n.startAngle));p1Y=(p*Math.sin(n.startAngle));p2X=(p*Math.cos(n.startAngle+(n.angle/4)));p2Y=(p*Math.sin(n.startAngle+(n.angle/4)));p3X=(p*Math.cos(n.startAngle+(n.angle/2)));p3Y=(p*Math.sin(n.startAngle+(n.angle/2)));p4X=(p*Math.cos(n.startAngle+(n.angle/1.5)));p4Y=(p*Math.sin(n.startAngle+(n.angle/1.5)));p5X=(p*Math.cos(n.startAngle+n.angle));p5Y=(p*Math.sin(n.startAngle+n.angle));arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]];arrPoint=[x,y];if(O(arrPoly,arrPoint)){ctx.restore();return{datapoint:[n.percent,n.data],dataIndex:0,series:n,seriesIndex:m}}}ctx.restore()}}return null}function U(l){f("plothover",l)}function S(l){f("plotclick",l)}function f(s,l){var m=D.offset(),o=parseInt(l.pageX-m.left),p=parseInt(l.pageY-m.top),t=W(o,p);if(A.grid.autoHighlight){for(var r=0;r<R.length;++r){var q=R[r];if(q.auto==s&&!(t&&q.series==t.series)){j(q.series)}}}if(t){Q(t.series,s)}var n={pageX:l.pageX,pageY:l.pageY};b.trigger(s,[n,t])}function Q(m,n){if(typeof m=="number"){m=series[m]}var l=G(m);if(l==-1){R.push({series:m,auto:n});D.triggerRedrawOverlay()}else{if(!n){R[l].auto=false}}}function j(m){if(m==null){R=[];D.triggerRedrawOverlay()}if(typeof m=="number"){m=series[m]}var l=G(m);if(l!=-1){R.splice(l,1);D.triggerRedrawOverlay()}}function G(n){for(var m=0;m<R.length;++m){var l=R[m];if(l.series==n){return m}}return -1}function X(o,m){var n=o.getOptions();var p=n.series.pie.radius>1?n.series.pie.radius:h*n.series.pie.radius;m.save();m.translate(c,M);m.scale(1,n.series.pie.tilt);for(i=0;i<R.length;++i){l(R[i].series)}E(m);m.restore();function l(q){if(q.angle<0){return}m.fillStyle="rgba(255, 255, 255, "+n.series.pie.highlight.opacity+")";m.beginPath();if(Math.abs(q.angle-Math.PI*2)>1e-09){m.moveTo(0,0)}m.arc(0,0,p,q.startAngle,q.startAngle+q.angle,false);m.closePath();m.fill()}}}var A={series:{pie:{show:false,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(D,E){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+E.color+';">'+D+"<br/>"+Math.round(E.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:0.5}}}};C.plot.plugins.push({init:B,options:A,name:"pie",version:"1.0"})})(jQuery);