/* Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 1.3.0
 *
 */
(function(A){jQuery.fn.extend({slimScroll:function(B){var C=A.extend({width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:0.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:0.2,railDraggable:!0,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px"},B);this.each(function(){function E(D){if(F){D=D||window.event;var Z=0;D.wheelDelta&&(Z=-D.wheelDelta/120);D.detail&&(Z=D.detail/3);A(D.target||D.srcTarget||D.srcElement).closest("."+C.wrapperClass).is(P.parent())&&O(Z,!0);D.preventDefault&&!L&&D.preventDefault();L||(D.returnValue=!1)}}function O(Z,c,D){L=!1;var a=Z,b=P.outerHeight()-Q.outerHeight();c&&(a=parseInt(Q.css("top"))+Z*parseInt(C.wheelStep)/100*Q.outerHeight(),a=Math.min(Math.max(a,0),b),a=0<Z?Math.ceil(a):Math.floor(a),Q.css({top:a+"px"}));N=parseInt(Q.css("top"))/(P.outerHeight()-Q.outerHeight());a=N*(P[0].scrollHeight-P.outerHeight());D&&(a=Z,Z=a/P[0].scrollHeight*P.outerHeight(),Z=Math.min(Math.max(Z,0),b),Q.css({top:Z+"px"}));P.scrollTop(a);P.trigger("slimscrolling",~~a);I();G()}function T(){window.addEventListener?(this.addEventListener("DOMMouseScroll",E,!1),this.addEventListener("mousewheel",E,!1),this.addEventListener("MozMousePixelScroll",E,!1)):document.attachEvent("onmousewheel",E)}function J(){K=Math.max(P.outerHeight()/P[0].scrollHeight*P.outerHeight(),V);Q.css({height:K+"px"});var D=K==P.outerHeight()?"none":"block";Q.css({display:D})}function I(){J();clearTimeout(U);N==~~N?(L=C.allowPageScroll,S!=N&&P.trigger("slimscroll",0==~~N?"top":"bottom")):L=!1;S=N;K>=P.outerHeight()?L=!0:(Q.stop(!0,!0).fadeIn("fast"),C.railVisible&&R.stop(!0,!0).fadeIn("fast"))}function G(){C.alwaysVisible||(U=setTimeout(function(){C.disableFadeOut&&F||(X||Y)||(Q.fadeOut("slow"),R.fadeOut("slow"))},1000))}var F,X,Y,U,W,K,N,S,V=30,L=!1,P=A(this);if(P.parent().hasClass(C.wrapperClass)){var M=P.scrollTop(),Q=P.parent().find("."+C.barClass),R=P.parent().find("."+C.railClass);J();if(A.isPlainObject(B)){if("height" in B&&"auto"==B.height){P.parent().css("height","auto");P.css("height","auto");var H=P.parent().parent().height();P.parent().css("height",H);P.css("height",H)}if("scrollTo" in B){M=parseInt(C.scrollTo)}else{if("scrollBy" in B){M+=parseInt(C.scrollBy)}else{if("destroy" in B){Q.remove();R.remove();P.unwrap();return}}}O(M,!1,!0)}}else{C.height="auto"==C.height?P.parent().height():C.height;M=A("<div></div>").addClass(C.wrapperClass).css({position:"relative",overflow:"hidden",width:C.width,height:C.height});P.css({overflow:"hidden",width:C.width,height:C.height});var R=A("<div></div>").addClass(C.railClass).css({width:C.size,height:"100%",position:"absolute",top:0,display:C.alwaysVisible&&C.railVisible?"block":"none","border-radius":C.railBorderRadius,background:C.railColor,opacity:C.railOpacity,zIndex:90}),Q=A("<div></div>").addClass(C.barClass).css({background:C.color,width:C.size,position:"absolute",top:0,opacity:C.opacity,display:C.alwaysVisible?"block":"none","border-radius":C.borderRadius,BorderRadius:C.borderRadius,MozBorderRadius:C.borderRadius,WebkitBorderRadius:C.borderRadius,zIndex:99}),H="right"==C.position?{right:C.distance}:{left:C.distance};R.css(H);Q.css(H);P.wrap(M);P.parent().append(Q);P.parent().append(R);C.railDraggable&&Q.bind("mousedown",function(Z){var D=A(document);Y=!0;t=parseFloat(Q.css("top"));pageY=Z.pageY;D.bind("mousemove.slimscroll",function(b){currTop=t+b.pageY-pageY;Q.css("top",currTop);O(0,Q.position().top,!1)});D.bind("mouseup.slimscroll",function(b){Y=!1;G();D.unbind(".slimscroll")});return !1}).bind("selectstart.slimscroll",function(D){D.stopPropagation();D.preventDefault();return !1});R.hover(function(){I()},function(){G()});Q.hover(function(){X=!0},function(){X=!1});P.hover(function(){F=!0;I();G()},function(){F=!1;G()});P.bind("touchstart",function(Z,D){Z.originalEvent.touches.length&&(W=Z.originalEvent.touches[0].pageY)});P.bind("touchmove",function(D){L||D.originalEvent.preventDefault();D.originalEvent.touches.length&&(O((W-D.originalEvent.touches[0].pageY)/C.touchScrollStep,!0),W=D.originalEvent.touches[0].pageY)});J();"bottom"===C.start?(Q.css({top:P.outerHeight()-Q.outerHeight()}),O(0,!0)):"top"!==C.start&&(O(A(C.start).position().top,null,!0),C.alwaysVisible||Q.hide());T()}});return this}});jQuery.fn.extend({slimscroll:jQuery.fn.slimScroll})})(jQuery);